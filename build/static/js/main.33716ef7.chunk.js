(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{274:function(e,t,n){e.exports=n(455)},455:function(e,t,n){"use strict";n.r(t);var a=n(130),r=n(0),o=n.n(r),l=n(72),i=n.n(l),c=n(79),s=n(56),u=n(78),m=n(71),d=n(263),g=n(24),h=n(262),p=n(8),E={wsUrl:"wss://lit-forest-54340.herokuapp.com/graphql",httpUrl:"https://lit-forest-54340.herokuapp.com/graphql"},f=n(19),b=n(31),v=n.n(b),y=n(42),w=function(e,t){return e.map(function(e){return e.id}).includes(t.id)},k=function(e){var t=Object.values(e).reduce(function(e,t){return t.concat(e)}).filter(function(e){return""!==e.model});if(0===t.length)throw new Error("Sensors loading");return t},O=function(e,t){var n=JSON.parse(localStorage.getItem("kaste-user-token"));localStorage.removeItem("kaste-user-token");var r=Object(a.a)({},n,{sensorEndpoint:e});window.localStorage.setItem("kaste-user-token",JSON.stringify(r)),t(r)},j=n(22),C=n(23);function S(){var e=Object(j.a)(["\n  query SensorData($sensorEndpoint: String!) {\n  sensorData (sensorEndpoint: $sensorEndpoint){\n    value\n  }\n}\n"]);return S=function(){return e},e}var x=Object(C.a)(S()),I=n(485),A=n(478),R=n(476),T=n(51),_=n(471),W=n(479),z=n(457),P=function(){var e=Object(c.b)();return function(t,n){return e.mutate({mutation:n,variables:{sensorEndpoint:t}})}};function D(){var e=Object(j.a)(["\nmutation startWatering(\n  $sensorEndpoint: String!\n  ) {\n    startWatering(\n    sensorEndpoint: $sensorEndpoint\n  ) {\n    message\n  }\n}\n"]);return D=function(){return e},e}var U=Object(C.a)(D()),$=function(e){var t=e.actions,n=e.wateringConnected,a=e.setPage,l=Object(r.useState)(!1),i=Object(f.a)(l,2),c=i[0],s=i[1],u=P(),m=function(e,t){try{s(!1),u(t,U),a("Video")}catch(n){console.error(n.message)}};return o.a.createElement(_.a,{centered:!0,basic:!0,open:c,onClose:function(){return s(!1)},trigger:o.a.createElement(R.a.Item,{"data-cy":"water-button",onClick:function(){return s(!0)},disabled:!n},o.a.createElement(T.a,{name:"shower"}),"Water Plants"),style:{textAlign:"center"}},o.a.createElement(T.a,{name:"shower",size:"massive"}),o.a.createElement(W.a,{content:"Choose watering duration:",icon:"clock"}),o.a.createElement(_.a.Actions,{style:{textAlign:"center",marginTop:15}},o.a.createElement(z.a.Group,null,o.a.createElement(z.a,{"data-cy":"modal-button-1min",color:"green",onClick:function(){return m(0,t.water.oneMin)}},"1 min"),o.a.createElement(z.a.Or,null),o.a.createElement(z.a,{"data-cy":"modal-button-5min",color:"green",onClick:function(){return m(0,t.water.fiveMin)}},"5 min"),o.a.createElement(z.a.Or,null),o.a.createElement(z.a,{"data-cy":"modal-button-10min",color:"green",onClick:function(){return m(0,t.water.tenMin)}},"10 min")),o.a.createElement(z.a,{"data-cy":"modal-button-cancel",color:"red",onClick:function(){return s(!1)},style:{marginTop:20}},"cancel")))};function L(){var e=Object(j.a)(["\nmutation stopWatering(\n  $sensorEndpoint: String!\n  ) {\n    stopWatering(\n    sensorEndpoint: $sensorEndpoint\n  ) {\n    message\n  }\n}\n"]);return L=function(){return e},e}var M=Object(C.a)(L()),N=function(e){var t=e.children,n=e.setPage,a=e.logOut,l=e.page,i=e.actions,c=e.token,s=Object(r.useState)(!1),u=Object(f.a)(s,2),m=u[0],d=u[1],g=Object(r.useState)(!1),h=Object(f.a)(g,2),p=h[0],E=h[1],b=Object(r.useState)(!1),v=Object(f.a)(b,2),y=v[0],w=v[1],k=P(),O=function(e){return function(){d(!1),n(e)}};return Object(r.useEffect)(function(){i?(E(void 0!==i.camera),w(void 0!==i.water)):(E(!1),w(!1))},[i]),o.a.createElement(o.a.Fragment,null,o.a.createElement(I.a,{maxWidth:I.a.onlyMobile.maxWidth,as:A.a.Pushable,style:{height:"100vh"}},o.a.createElement(A.a,{as:R.a,animation:"push",inverted:!0,onHide:function(){return d(!1)},vertical:!0,visible:m,icon:"labeled",width:"thin"},c&&o.a.createElement(R.a.Header,{as:"small",style:{color:"white"}},o.a.createElement(T.a,{name:"user",color:"green"}),c.username),o.a.createElement(R.a.Item,{"data-cy":"sensors-button",onClick:O("Sensors")},o.a.createElement(T.a,{name:"info"}),"Sensors"),o.a.createElement(R.a.Item,{"data-cy":"chat-button",onClick:O("Chat")},o.a.createElement(T.a,{name:"comments outline"}),"Chat"),o.a.createElement(R.a.Item,{"data-cy":"settings-button",onClick:O("Settings")},o.a.createElement(T.a,{name:"settings"}),"Settings"),o.a.createElement(R.a.Item,{"data-cy":"about-button",onClick:O("About")},o.a.createElement(T.a,{name:"question"}),"About"),o.a.createElement(R.a.Item,{"data-cy":"livefeed-button",disabled:!p,onClick:O("Video")},o.a.createElement(T.a,{name:"eye"}),"Live Feed"),o.a.createElement($,{actions:i,wateringConnected:y,setPage:n}),o.a.createElement(R.a.Item,{"data-cy":"stop-button",disabled:!y,onClick:function(){d(!1),k(i.water.waterstop,M)}},o.a.createElement(T.a,{name:"stop circle"}),"Stop Watering")),o.a.createElement(A.a.Pusher,{style:{height:"100%"},dimmed:m},o.a.createElement(R.a,{widths:3,inverted:!0,pointing:!0,color:"green",size:"large",style:{height:"50px",marginBottom:0,borderRadius:0}},o.a.createElement(R.a.Item,{onClick:function(){return d(!0)},style:{alignSelf:"center"}},o.a.createElement(T.a,{"data-cy":"sidebar-button",name:"sidebar"})),o.a.createElement(R.a.Item,{header:!0},l),o.a.createElement(R.a.Item,{position:"right",onClick:function(){return a()},style:{alignSelf:"center"}},o.a.createElement(T.a,{name:"log out"}))),o.a.createElement("div",{style:{height:"calc(100vh - 50px)"}},t))))},F=function(e){var t=e.children,n=e.setPage,a=e.logOut,l=e.actions,i=e.token,c=Object(r.useState)(!1),s=Object(f.a)(c,2),u=s[0],m=s[1],d=Object(r.useState)(!1),g=Object(f.a)(d,2),h=g[0],p=g[1],E=P(),b=function(e){return function(){n(e)}};return Object(r.useEffect)(function(){l?(m(void 0!==l.camera),p(void 0!==l.water)):(m(!1),p(!1))},[l]),o.a.createElement(o.a.Fragment,null,o.a.createElement(I.a,{style:{height:"100vh"},minWidth:I.a.onlyTablet.minWidth},o.a.createElement(R.a,{style:{height:71},inverted:!0,icon:"labeled",color:"green",fixed:"top"},o.a.createElement(R.a.Item,{"data-cy":"sensors-button",onClick:b("Sensors")},o.a.createElement(T.a,{name:"info"}),"Sensors"),o.a.createElement(R.a.Item,{"data-cy":"chat-button",onClick:b("Chat")},o.a.createElement(T.a,{name:"comments outline"}),"Chat"),o.a.createElement($,{actions:l,wateringConnected:h,setPage:n}),o.a.createElement(R.a.Item,{"data-cy":"stop-button",disabled:!h,onClick:function(){E(l.water.waterstop,M)}},o.a.createElement(T.a,{name:"stop circle"}),"Stop Watering"),o.a.createElement(R.a.Item,{"data-cy":"livefeed-button",disabled:!u,onClick:b("Video")},o.a.createElement(T.a,{name:"eye"}),"Live Feed"),o.a.createElement(R.a.Menu,{position:"right"},i&&o.a.createElement(R.a.Header,{as:"p",style:{color:"white",alignSelf:"center",margin:"0 10px 0"}},o.a.createElement(T.a,{name:"user"}),i.username," ",o.a.createElement("br",null),"logged in"),o.a.createElement(R.a.Item,{"data-cy":"settings-button",onClick:b("Settings")},o.a.createElement(T.a,{name:"settings"}),"Settings"),o.a.createElement(R.a.Item,{"data-cy":"about-button",onClick:b("About")},o.a.createElement(T.a,{name:"question"}),"About"),o.a.createElement(R.a.Item,{"data-cy":"logout-button",onClick:function(){return a(!1)}},o.a.createElement(T.a,{name:"log out"}),"Log out"))),o.a.createElement("div",{style:{height:71}}),o.a.createElement("div",{style:{height:"calc(100vh - 71px)"}},t)))},q=function(e){var t=e.children,n=e.setPage,a=e.logOut,r=e.page,l=e.actions,i=e.token,c=e.sensorService;return o.a.createElement(o.a.Fragment,null,o.a.createElement(N,{logOut:a,page:r,actions:l,setPage:n,token:i,sensorService:c},t),o.a.createElement(F,{logOut:a,page:r,actions:l,setPage:n,token:i,sensorService:c},t))},H=n(480),B=n(475),Y=n(44),K=n(470),J=n(481),G=n(464);function V(){var e=Object(j.a)(["\nmutation loginUser(\n  $password: String!\n  $username: String!\n  ) {\n  login(\n    password: $password\n    username: $username\n  ) {\n    value\n    username\n    sensorEndpoint\n  }\n}\n"]);return V=function(){return e},e}var Q=Object(C.a)(V());function X(){var e=Object(j.a)(["\n{\n  me {\n    name\n    username\n    id\n    sensorEndpoint\n  }\n}\n"]);return X=function(){return e},e}var Z=Object(C.a)(X()),ee=function(e){var t=Object(r.useState)(""),n=Object(f.a)(t,2),a=n[0],o=n[1];return{type:e,value:a,onChange:function(e){o(e.target.value)},reset:function(){o("")}}},te=function(e){var t=e.setNotification,n=e.setToken,a=Object(G.a)(Q),r=ee("text"),l=(r.reset,Object(Y.a)(r,["reset"])),i=ee("password"),c=(i.reset,Object(Y.a)(i,["reset"])),s=function(){var e=Object(y.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a({update:function(e,t){var a=t.data.login;n(a),localStorage.setItem("kaste-user-token",JSON.stringify(a))},variables:{username:l.value,password:c.value},refetchQueries:[{query:Z}]});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),t(e.t0.graphQLErrors[0].message);case 8:case"end":return e.stop()}},e,null,[[0,5]])}));return function(){return e.apply(this,arguments)}}();return o.a.createElement(K.a,{size:"large",onSubmit:s},o.a.createElement(J.a,{stacked:!0,raised:!0},o.a.createElement(K.a.Input,Object.assign({},l,{"data-cy":"username",fluid:!0,icon:"user",iconPosition:"left",placeholder:"Username",autoComplete:"current-username"})),o.a.createElement(K.a.Input,Object.assign({},c,{"data-cy":"password",fluid:!0,icon:"lock",iconPosition:"left",placeholder:"Password",autoComplete:"current-password"})),o.a.createElement(z.a,{color:"brown",size:"large",type:"submit"},"Log in")))};function ne(){var e=Object(j.a)(["\nmutation createUser(\n  $name: String!\n  $password: String!\n  $username: String!\n  ) {\n  createUser(\n    password: $password\n    username: $username\n    name: $name\n  ) {\n    username\n    sensorEndpoint\n  }\n}\n"]);return ne=function(){return e},e}var ae=Object(C.a)(ne()),re=function(e){var t=e.setNotification,n=e.setLoginVisible,a=Object(G.a)(ae),r=ee("text"),l=r.reset,i=Object(Y.a)(r,["reset"]),c=ee("text"),s=c.reset,u=Object(Y.a)(c,["reset"]),m=ee("password"),d=m.reset,g=Object(Y.a)(m,["reset"]),h=function(){var e=Object(y.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,a({variables:{username:i.value,password:g.value,name:u.value}});case 3:t("Register succesful"),l(),s(),d(),n(!0),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0),t(e.t0.graphQLErrors[0].message);case 14:case"end":return e.stop()}},e,null,[[0,10]])}));return function(){return e.apply(this,arguments)}}();return o.a.createElement(K.a,{size:"large",onSubmit:h,autoComplete:"new-password"},o.a.createElement(J.a,{stacked:!0,raised:!0},o.a.createElement(K.a.Input,Object.assign({},i,{"data-cy":"username",fluid:!0,icon:"user",iconPosition:"left",placeholder:"Username",autoComplete:"new-password"})),o.a.createElement(K.a.Input,Object.assign({},u,{"data-cy":"name",fluid:!0,icon:"user outline",iconPosition:"left",placeholder:"Name",autoComplete:"new-password"})),o.a.createElement(K.a.Input,Object.assign({},g,{"data-cy":"password",fluid:!0,icon:"lock",iconPosition:"left",placeholder:"Password",autoComplete:"new-password"})),o.a.createElement(z.a,{color:"brown",size:"large",type:"submit"},"Register")))},oe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=Object(r.useState)(null),n=Object(f.a)(t,2),a=n[0],o=n[1];return[a,function(t){o(t),setTimeout(function(){o(null)},1e3*e)}]},le=function(e){var t=e.setToken,n=oe(),a=Object(f.a)(n,2),l=a[0],i=a[1],c=Object(r.useState)(!0),s=Object(f.a)(c,2),u=s[0],m=s[1];return o.a.createElement("div",{className:"login-form"},o.a.createElement("style",null," ","\n  body > div,\n  body > div > div,\n  body > div > div > div.login-form {\n    height: 100%;\n  }\n          "),o.a.createElement(H.a,{textAlign:"center",style:{height:"100vh",background:"lightgreen",margin:0},verticalAlign:"middle"},o.a.createElement(H.a.Column,{style:{maxWidth:250}},o.a.createElement(W.a,{as:"h1",color:"grey",dividing:!0,textAlign:"center"},"Log in to Kaste 2.0"),o.a.createElement(R.a,{widths:2,color:"brown"},o.a.createElement(R.a.Item,{onClick:function(){return m(!0)},active:u},"Login"),o.a.createElement(R.a.Item,{onClick:function(){return m(!1)},active:!u},"Register")),u?o.a.createElement(te,{setNotification:i,setToken:t}):o.a.createElement(re,{setLoginVisible:m,setNotification:i}),l&&o.a.createElement(B.a,{positive:"Register succesful"===l,negative:"Register succesful"!==l},l))))},ie=n(39),ce=n.n(ie),se=function(e){var t=e.value,n=e.icon,a=e.iconColor,r=e.size;return o.a.createElement("div",null,o.a.createElement(T.a,{name:n,size:r,color:a||null}),o.a.createElement("span",{style:{fontSize:"".concat("large"===r?"15px":"11px"),verticalAlign:"middle"}},t))},ue=n(482),me=n(256);function de(){var e=Object(j.a)(["\n  query ChartData($id: Int!, $type: HousePlant!, $range: DayWeekMonthYear!) {\n  chartData(id: $id, type: $type, range: $range) {\n    time\n    light_lux\n    ec_mS_cm\n    soil_moisture\n    temperature_C\n    humidity\n  }\n}\n"]);return de=function(){return e},e}var ge=Object(C.a)(de()),he=n(477),pe=n(466),Ee=function(e){var t=e.inverted;return o.a.createElement(he.a,{inverted:t,active:!0},o.a.createElement(pe.a,{size:"massive"},"Loading"))},fe=function(e,t){return{layout:{padding:{bottom:"".concat("DAY"===e||"WEEK"===e&&window.innerWidth<848?-15:0)}},scales:{xAxes:[{type:"time",time:{unit:function(){switch(e){case"DAY":return"minute";case"WEEK":return"hour";case"MONTH":case"YEAR":return"day"}}(),displayFormats:{minute:"HH:mm",hour:"dd HH:mm",day:"DD.M"}},ticks:{autoSkip:!0,maxTicksLimit:6}}],yAxes:[{ticks:{suggestedMin:0,max:function(){switch(t[0]){case"temperature_C":return 100;case"light_lux":return 128e3;case"ec_mS_cm":return 5}}()}}]},legend:{display:!1}}},be=function(e){var t=e.sensor,n=e.chartTimeRange,a=e.chartFilter,r=Object(ue.a)(ge,{variables:{id:t.id,type:t.type.toUpperCase(),range:n},fetchPolicy:"no-cache"});if(console.log("plantData",r),r.loading)return o.a.createElement("div",{style:{minHeight:"calc(89vw / 2)"}},o.a.createElement(Ee,{inverted:!0}));if(0===Object.keys(r.data).length)return o.a.createElement(J.a,{color:"red",inverted:!0,secondary:!0},"Chart failed to load");var l=function(e,t){var n=e.chartData;return Object.keys(n).reduce(function(e,a){if("__typename"===a||null===n[a])return e;if("time"===a)return e.labels=n[a].map(function(e){return ce.a.relativeTimeThreshold("h",25),ce()(e).subtract(3,"hours")}),e;var r=function(e){switch(e){case"temperature_C":return"rgba(250, 64, 61, 0.7)";case"ec_mS_cm":return"rgba(250, 158, 61, 0.7)";case"light_lux":return"rgba(246, 250, 61, 0.7)";case"humidity":case"soil_moisture":return"rgba(61, 152, 250, 0.7)"}};return t.includes(a)&&(console.log("cur",a),e.datasets.push({label:a,fill:!1,lineTension:.1,backgroundColor:r(a),borderColor:r(a),borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:r(a),pointBackgroundColor:"#fff",pointBorderWidth:1,pointHoverRadius:5,pointHoverBackgroundColor:r(a),pointHoverBorderColor:r(a),pointHoverBorderWidth:2,pointRadius:1,pointHitRadius:10,data:n[a]})),e},{labels:[],datasets:[]})}(r.data,a);return o.a.createElement(me.a,{data:l,options:fe(n,a)})},ve={padding:0,margin:0},ye=["temperature_C","soil_moisture"],we=["light_lux"],ke=["ec_mS_cm"],Oe=function(e){var t=e.sensor,n=Object(r.useState)(!1),a=Object(f.a)(n,2),l=a[0],i=a[1],c=Object(r.useState)("DAY"),s=Object(f.a)(c,2),u=s[0],m=s[1],d=Object(r.useState)(ye),g=Object(f.a)(d,2),h=g[0],p=g[1];return o.a.createElement(J.a,{color:"green",inverted:!0,secondary:!0,style:{margin:"2px 1px"}},o.a.createElement(W.a,{textAlign:"center",as:"h3"},o.a.createElement("a",{style:{color:"inherit"},href:"https://en.wikipedia.org/wiki/".concat(t.name),target:"_blank",rel:"noopener noreferrer"},o.a.createElement(T.a,{name:"leaf",size:"large"})),t.name),o.a.createElement(H.a,{textAlign:"center",columns:4},o.a.createElement(H.a.Row,null,o.a.createElement(H.a.Column,{style:ve,color:t.soil_moisture<10?"red":null},o.a.createElement(se,{size:"large",value:t.soil_moisture+" %",label:"Soil moisture",icon:"theme",iconColor:"blue"})),o.a.createElement(H.a.Column,{style:ve},o.a.createElement(se,{size:"large",value:Math.floor(t.light_lux),label:"Light",icon:"sun",iconColor:"yellow"})),o.a.createElement(H.a.Column,{style:ve},o.a.createElement(se,{size:"large",value:t.ec_mS_cm,label:"Nutrient",icon:"pills",iconColor:"orange"})),o.a.createElement(H.a.Column,{style:ve},o.a.createElement(se,{size:"large",value:t.temperature_C+" \xbaC",label:"Temperature",icon:"thermometer",iconColor:"red"}))),o.a.createElement(H.a.Row,{columns:"1",style:{padding:0}},o.a.createElement(H.a.Column,{textAlign:"center"},o.a.createElement(z.a,{"data-cy":"chart-toggle-button",circular:!0,icon:l?"close":"chart area",onClick:function(){return i(!l)}}))),o.a.createElement(H.a.Row,{columns:1,centered:!0,style:{display:"".concat(l?"block":"none"),padding:5}},o.a.createElement(z.a.Group,{attached:"top"},o.a.createElement(z.a,{onClick:function(){return m("DAY")}},"D"),o.a.createElement(z.a,{onClick:function(){return m("WEEK")}},"W"),o.a.createElement(z.a,{onClick:function(){return m("MONTH")}},"M"),o.a.createElement(z.a,{onClick:function(){return m("YEAR")}},"Y")),o.a.createElement(H.a.Column,{textAlign:"center",style:{padding:0}},o.a.createElement(J.a,{style:{margin:"0 auto",padding:5,maxWidth:1300}},o.a.createElement(be,{sensor:t,chartTimeRange:u,chartFilter:h}))),o.a.createElement(z.a.Group,{attached:"bottom"},o.a.createElement(z.a,{onClick:function(){return p(ye)}},"moist. + temp"),o.a.createElement(z.a,{onClick:function(){return p(we)}},"light"),o.a.createElement(z.a,{onClick:function(){return p(ke)}},"nutrition"))),o.a.createElement(H.a.Row,{columns:2,style:{padding:5}},o.a.createElement(H.a.Column,{textAlign:"left"},o.a.createElement(se,{value:ce()(t.time).fromNow(),label:"Updated",size:"small",icon:"time",iconColor:ce()()-ce()(t.time)>36e5?"red":null})),o.a.createElement(H.a.Column,{textAlign:"right"},o.a.createElement(se,{value:t.battery_low+" %",label:"Battery",size:"small",icon:"battery full",iconColor:t.battery_low<30?"red":null})))))},je=["temperature_C","humidity"],Ce=function(e){var t=e.sensor,n=Object(r.useState)(!1),a=Object(f.a)(n,2),l=a[0],i=a[1],c=Object(r.useState)("DAY"),s=Object(f.a)(c,2),u=s[0],m=s[1];return o.a.createElement(J.a,{inverted:!0,secondary:!0,style:{margin:"2px 1px",background:"beige",color:"black"}},o.a.createElement(W.a,{style:{color:"black"},textAlign:"center",as:"h3"},o.a.createElement(T.a,{name:"home",color:"black",size:"large"}),t.location),o.a.createElement(H.a,{textAlign:"center",columns:2},o.a.createElement(H.a.Row,null,o.a.createElement(H.a.Column,null,o.a.createElement(se,{size:"large",value:t.humidity+" %",label:"Soil moisture",icon:"theme",iconColor:"blue"})),o.a.createElement(H.a.Column,null,o.a.createElement(se,{size:"large",value:t.temperature_C+" \xbaC",label:"Temperature",icon:"thermometer",iconColor:"red"}))),o.a.createElement(H.a.Row,{columns:"1",style:{padding:0}},o.a.createElement(H.a.Column,{textAlign:"center"},o.a.createElement(z.a,{circular:!0,icon:l?"close":"chart area",onClick:function(){return i(!l)}}),l&&o.a.createElement(o.a.Fragment,null,o.a.createElement(z.a,{circular:!0,onClick:function(){return m("DAY")}},"D"),o.a.createElement(z.a,{circular:!0,onClick:function(){return m("WEEK")}},"W"),o.a.createElement(z.a,{circular:!0,onClick:function(){return m("MONTH")}},"M"),o.a.createElement(z.a,{circular:!0,onClick:function(){return m("YEAR")}},"Y")))),o.a.createElement(H.a.Row,{columns:1,style:{padding:"".concat(l?"5px":"0px")}},o.a.createElement(H.a.Column,{style:{padding:0}},o.a.createElement(J.a,{style:{margin:"0 auto",display:"".concat(l?"block":"none"),padding:5,maxWidth:1300}},o.a.createElement(be,{sensor:t,chartTimeRange:u,chartFilter:je})))),o.a.createElement(H.a.Row,{columns:2,style:{padding:5}},o.a.createElement(H.a.Column,{textAlign:"left"},o.a.createElement(se,{value:ce()(t.time).fromNow(),label:"Updated",size:"small",icon:"time",iconColor:ce()()-ce()(t.time)>36e5?"red":null})),o.a.createElement(H.a.Column,{textAlign:"right"},o.a.createElement(se,{label:"Battery",size:"small",icon:"battery full",iconColor:1===t.battery_low?"red":null})))))},Se=function(e){var t=e.show,n=e.sensorData,a=e.sensorError,r=e.token;if(!t)return null;return o.a.createElement("div",{style:{height:"100%",overflowY:"scroll"}},a||!r.sensorEndpoint?"Sensors loading"===a?o.a.createElement(J.a,{secondary:!0,inverted:!0,color:"green",textAlign:"center"},"Sensors loading"):r.sensorEndpoint&&"GraphQL error: Request failed with status code 404"!==a?null:o.a.createElement(J.a,{secondary:!0,inverted:!0,color:"red",textAlign:"center"},r.sensorEndpoint?"Rasp offline or starting from reboot":"Not connected to any sensor endpoint"):n?n.map(function(e){return"plant"===e.type?o.a.createElement(Oe,{key:e.id,sensor:e}):o.a.createElement(Ce,{key:e.id,sensor:e})}):null)},xe=n(468),Ie=n(469),Ae=n(473),Re=n(465);function Te(){var e=Object(j.a)(["\n{\n  messages {\n    content\n    created\n    id\n    user {\n      name\n    }\n  }\n}\n"]);return Te=function(){return e},e}var _e=Object(C.a)(Te());function We(){var e=Object(j.a)(["\nmutation createMessage(\n  $content: String!\n  ) {\n  createMessage(\n    content: $content\n  ) {\n    content\n    user {\n      name\n    }\n    created\n    id\n  }\n}\n"]);return We=function(){return e},e}var ze=Object(C.a)(We());function Pe(){var e=Object(j.a)(["\nsubscription {\n  messageAdded {\n    content\n    created\n    id\n    user {\n      name\n    }\n  }\n}\n"]);return Pe=function(){return e},e}var De=Object(C.a)(Pe()),Ue=n(467),$e=function(e){var t=e.message,n=e.currentUser;if(!n.me)return null;var a=n.me.name===t.user.name?"blue":"green",r=n.me.name===t.user.name?"right":"left",l={margin:"0 0 5px 0",padding:7,float:"".concat(r),clear:"both"};return o.a.createElement(Ae.a,{"data-cy":"message",style:{marginTop:7,paddingTop:7,overflow:"auto"}},o.a.createElement(J.a,{style:l,compact:!0,inverted:!0,color:a,secondary:!0},o.a.createElement(Ae.a.Content,null,o.a.createElement(Ae.a.Author,{as:"span"},t.user.name),o.a.createElement(Ae.a.Metadata,null,o.a.createElement("div",null,new Date(parseInt(t.created)).toLocaleString())),o.a.createElement(Ue.a,{style:{margin:"4px 0px 4px 0px"}}),t.content)))},Le=function(e){var t=e.show,n=Object(ue.a)(_e),a=n.data,l=n.loading,i=Object(ue.a)(Z),c=ee("text"),s=c.reset,u=Object(Y.a)(c,["reset"]),m=Object(G.a)(ze),d=Object(r.useRef)(null);Object(r.useEffect)(function(){g()},[t]);Object(xe.a)(De,{onSubscriptionData:function(e){var t=e.client,n=e.subscriptionData,a=t.readQuery({query:_e}),r=n.data.messageAdded;w(a.messages,r.id)||(a.messages.push(r),t.writeQuery({query:_e,data:a,id:1}),d.current.scrollIntoView({block:"end",behavior:"smooth"}))}});var g=function(){d.current&&d.current.scrollIntoView({block:"end"})},h=function(){u.length<1||(m({variables:{content:u.value}}),s())};return t?o.a.createElement("div",{style:{height:"100%"}},o.a.createElement("div",{style:{height:"calc(100% -  60px)",overflowY:"scroll"}},o.a.createElement(Ie.a,null,l||i.loading?o.a.createElement(Ee,{inverted:!0}):o.a.createElement(Ae.a.Group,null,void 0!==a.messages?a.messages.map(function(e){return o.a.createElement($e,{key:e.id,message:e,currentUser:i.data})}):null),o.a.createElement("div",{id:"el",ref:d}))),o.a.createElement(R.a,{fluid:!0,color:"grey",style:{marginBottom:0,marginTop:0,height:"60px"}},o.a.createElement(R.a.Item,{style:{width:"80vw"}},o.a.createElement(Re.a,Object.assign({},u,{"data-cy":"chat-input",fluid:!0,onKeyPress:function(e){"Enter"===e.key&&h()},onFocus:g}))),o.a.createElement(R.a.Item,{style:{width:"20vw",justifyContent:"center"},onClick:h},o.a.createElement(T.a,{name:"send",inverted:!0,circular:!0,color:"green"})))):null},Me=n(474),Ne=function(e){var t=e.header,n=e.children;return o.a.createElement(o.a.Fragment,null,o.a.createElement("h4",null,o.a.createElement("strong",null,t)),o.a.createElement("p",null,n))},Fe=n(472),qe=function(e){var t=e.name,n=e.githubUrl,a=e.linkedInUrl,r=e.email;return o.a.createElement(Fe.a,{trigger:o.a.createElement("span",{style:{color:"blue"}},t),flowing:!0,hoverable:!0,hideOnScroll:!0},o.a.createElement(H.a,{centered:!0,divided:!0,columns:3},o.a.createElement(H.a.Column,{textAlign:"center"},o.a.createElement("a",{href:n,target:"_blank",rel:"noopener noreferrer"},o.a.createElement(T.a,{color:"black",size:"large",name:"github"}))),o.a.createElement(H.a.Column,{textAlign:"center"},o.a.createElement("a",{href:a,target:"_blank",rel:"noopener noreferrer"},o.a.createElement(T.a,{color:"blue",size:"large",name:"linkedin"}))),o.a.createElement(H.a.Column,{textAlign:"center"},o.a.createElement(Fe.a,{trigger:o.a.createElement("a",{href:"mailto:".concat(r,"?Subject=About%20Kaste 2.0")},o.a.createElement(T.a,{color:"green",size:"large",name:"at"}))},"tommi.teetee@hotmail.com"))))},He={fontSize:18},Be=function(e){return e.show?o.a.createElement("div",{style:{height:"100%",overflowY:"scroll",paddingBottom:25}},o.a.createElement(Ie.a,{textAlign:"left",style:{fontSize:16}},o.a.createElement(W.a,{textAlign:"center",as:"h1",style:{paddingTop:25,margin:0}},"About Kaste 2.0 ",o.a.createElement("span",{role:"img","aria-label":"seedling"},"\ud83c\udf31")),o.a.createElement("h3",{style:He},"Aim:"),o.a.createElement("p",null,"Design and implement a responsive web app to monitor and water plants."),o.a.createElement("h3",{style:He},"Features:"),o.a.createElement("ul",null,o.a.createElement("li",null,"Plantwatering functionality for two or more users"),o.a.createElement("li",null,"Possibility to read plant info through charts"),o.a.createElement("li",null,"Simple chat"),o.a.createElement("li",null,"Rebooting Raspberry (that controls sensor data)")),o.a.createElement(J.a,{style:{background:"lightgreen"}},o.a.createElement("p",null,"Any questions, tips, feedback or bug reports are much appreciated! Just post them in the chat or tommi.teetee@hotmail.com ",o.a.createElement("span",{role:"img","aria-label":"happy smiley"},"\ud83d\ude42"))),o.a.createElement("h4",{style:He},"Made by:"),o.a.createElement(qe,{name:"Tommi Tampio",linkedInUrl:"https://www.linkedin.com/in/tommi-tampio-41b2b7113/",githubUrl:"https://github.com/stutommi",email:"tommi.teetee@hotmail.com"}),o.a.createElement("span",null," - Web app"),o.a.createElement("br",null),o.a.createElement("span",null,"Matti Tampio - Raspberry / sensor configuration"),o.a.createElement(Ue.a,{section:!0}),o.a.createElement("h3",{style:He},"Get started:"),o.a.createElement(Me.a,{ordered:!0},o.a.createElement(Me.a.Item,null,"Navigate to settings from menu"),o.a.createElement(Me.a.Item,null,"Provide an url that serves sensor data"),o.a.createElement(Me.a.Item,null,'Navigate to "Sensors"-view to check sensor measurements'),o.a.createElement(Me.a.Item,null,"Use features (watering, live feed) from the menu"),o.a.createElement(Me.a.Item,null,"Use that chat if you dare ",o.a.createElement("span",{role:"img","aria-label":"devil"},"\ud83d\udc7b"))),o.a.createElement(Ue.a,{section:!0}),o.a.createElement("h3",{style:He},"Client:"),o.a.createElement("p",null,o.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/stutommi/kaste_2.0-frontend"},"Link to code")),o.a.createElement("p",null,"Working with token based authetication, client side is done with React. Its state is managed with hooks for the most part and little with Apollos client. Layout is handled with inline styles and semantic-ui-react. Communication between client and server is done with Graphql."),o.a.createElement(Ne,{header:"Layout and Menus"},"Kastes layout is designed mobile first, but should work in every screen size. Mobile menu has a fixed menu on top with logout and togglable sidebar, which contains view navigation and functionality. When screen size goes over mobile, the view changes to a fixed top menu, which displays navigation and functionality."),o.a.createElement(Ne,{header:"Sensors"},"Sensors data is shown in sensors view. It shows the current value of sensor measurements and chart information on measurement history that can be shown by different time ranges. clicking on the leaf icon in plant sensors opens a new tab in wikipedia, showing the results matching the name of the plant."),o.a.createElement(Ne,{header:"Chat"},"Kaste has a supersimple chat. Users can write and receive messages on realtime thanks to subscription based communication with server. Messages are stored in MongoDB."),o.a.createElement(Ne,{header:"Settings"},"In order to see any sensor information, user needs to be connected to an endpoint that serves that information. This connection can be made in settings page. If client is able to connect to an endpoint provided by the user, it will start displaying and storing that information on database. Settings page also shows the status of the endpoint"),o.a.createElement(Ne,{header:"Live Feed"},'If the endpoint a user is connected to has a camera connection, users are able to monitor this connection through the "Live Feed" view. This is useful when you want to make sure that your plants are being watered after using watering functionality. Note that if you have a slow internet connection, the picture may refresh much slower (or completely), but the watering funcionality still works.'),o.a.createElement(Ne,{header:"Water Plants"},'Perhaps the most important feature of Kaste is its watering functionality. Provided that the watering mechanics are hooked correctly at users home, user is able to water their plants by pressing the "Water Plants" found on the menu. They are able to choose watering between durations of 1, 5 and 10 minutes. If there"s a need to stop the watering process for whatever reasons, user can simply press "Stop Watering" found next to watering functionality.'),o.a.createElement(Ue.a,{section:!0}),o.a.createElement("h3",{style:He},"Server:"),o.a.createElement("p",null,o.a.createElement("a",{target:"_blank",rel:"noopener noreferrer",href:"https://github.com/stutommi/kaste_2.0-backend"},"Link to code")),o.a.createElement("p",null,"Servers main two tasks are handling Graphql requests coming from client and storing collecting and storing messages, user information and sensor data to mongoDB. It is important to note that all requests that client sends to other URLs go through the server. this is done to avoid mixed content warning that comes from making direct requests from Kaste (https) to sensor endpoints (possibly http)."),o.a.createElement(Ne,{header:"User information"},"User information contains name, username, password hash and an endpoint for sensordata. When ever a new endpoint is introduced, server logic will start fetching information from the endpoint."),o.a.createElement(Ne,{header:"Messages"},"Messages are stored in MongoDB and used in the chat view of the client. It uses a subscription so any new message is delivered to chat in realtime without refreshing the page. Currently the message live forever in the DB without manual deletion, this could be changed in the future to last only a certain time."),o.a.createElement(Ne,{header:"Sensor data"},"Servers two jobs for sensor data is to relay realtime sensor values and functionality to client and store values from all connected endpoints to database. These jobs are not connected to each other in any way. Server is always on update with all sensor endpoints of every user and fetches data from them at certain interval. If nobody is using an endpoint anymore, server stops fetching and storing data from it."),o.a.createElement(J.a,{color:"yellow"},"Known issues:",o.a.createElement("ul",null,o.a.createElement("li",null,"Endpoint computer might not recover from reboot"),o.a.createElement("li",null,"Tests insufficient (need to dig into graphql tests more)"),o.a.createElement("li",null,"Loading component renders over menu"),o.a.createElement("li",null,"Plant name is hardcoded"),o.a.createElement("li",null,"Live feed can freeze with slow internet connection"))),o.a.createElement(J.a,{color:"green"},"Things to improve:",o.a.createElement("ul",null,o.a.createElement("li",null,"Clean codebase"),o.a.createElement("li",null,"More tests"),o.a.createElement("li",null,"More comments"),o.a.createElement("li",null,"Improve Chat (amount of initial messages)"),o.a.createElement("li",null,"Optimize chart ranges"),o.a.createElement("li",null,"Add CO measurements to house sensors"),o.a.createElement("li",null,"Add auto-watering feature"),o.a.createElement("li",null,"Add feature to email user when plant is dry"))))):null};function Ye(){var e=Object(j.a)(["\nmutation editUserSensorEndpoint(\n  $sensorEndpoint: String!\n  ) {\n    editUserSensorEndpoint(\n    sensorEndpoint: $sensorEndpoint\n  ) {\n    sensorEndpoint\n    name\n    username\n  }\n}\n"]);return Ye=function(){return e},e}var Ke=Object(C.a)(Ye());function Je(){var e=Object(j.a)(["\nmutation reboot(\n  $sensorEndpoint: String!\n  ) {\n    reboot(\n    sensorEndpoint: $sensorEndpoint\n  ) {\n    message\n  }\n}\n"]);return Je=function(){return e},e}var Ge=Object(C.a)(Je());function Ve(){var e=Object(j.a)(["\nmutation validateSensorEndpoint(\n  $sensorEndpoint: String!\n  ) {\n    validateSensorEndpoint(\n    sensorEndpoint: $sensorEndpoint\n  ) {\n    message\n  }\n}\n"]);return Ve=function(){return e},e}var Qe=Object(C.a)(Ve()),Xe=function(e){var t=e.sensorsConnected,n=e.token,a=e.setToken,r=e.actions,l=e.sensorService,i=ee("text"),c=i.reset,s=Object(Y.a)(i,["reset"]),u=oe(),m=Object(f.a)(u,2),d=m[0],g=m[1],h=Object(G.a)(Ke),p=P(),E=function(){var e=Object(y.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p(s.value,Qe);case 3:"Valid endpoint"===e.sent.data.validateSensorEndpoint.message&&window.confirm("Would you like to receive information about these sensors?")&&(h({variables:{sensorEndpoint:s.value}}),O(s.value,a),c()),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),g("Sensor endpoint offline or invalid URL");case 11:case"end":return e.stop()}},e,null,[[0,8]])}));return function(){return e.apply(this,arguments)}}(),b=function(){var e=Object(y.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:window.confirm("WARNING: Endpoint computer might not recover correctly from reboot!")&&(p(r.reboot,Ge),l.stopFetching(),setTimeout(function(){l.startFetching(n.sensorEndpoint)},5e3));case 2:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();return o.a.createElement(J.a,null,o.a.createElement(W.a,null,"Sensor resource URL"),o.a.createElement("small",{style:{color:"gray"}},"Provide an endpoint URL where sensor output comes from"),o.a.createElement(Re.a,Object.assign({},s,{"data-cy":"sensor-url-input",fluid:!0,placeholder:"Enter URL...",action:o.a.createElement(z.a,{"data-cy":"sensor-url-button",loading:!1,onClick:E},"Connect")})),n.sensorEndpoint?o.a.createElement(o.a.Fragment,null,o.a.createElement(J.a,{color:"green"},o.a.createElement(W.a,{as:"h3"},"connected at:"),n.sensorEndpoint,o.a.createElement(z.a,{fluid:!0,style:{marginTop:10},onClick:function(){window.confirm("Are you sure? Clearing sensor resource url cuts access to all information and functionality.")&&(h({variables:{sensorEndpoint:""}}),O("",a))}},"clear")),o.a.createElement(J.a,{inverted:!0,secondary:!0,color:t?"green":"red"},o.a.createElement(H.a,{divided:!0,columns:2,textAlign:"center"},o.a.createElement(H.a.Row,{verticalAlign:"middle"},o.a.createElement(H.a.Column,null,"Endpoint status: ",t?"Online":"Offline"),o.a.createElement(H.a.Column,null,o.a.createElement(z.a,{disabled:!t,onClick:b,icon:"redo",content:"Reboot"})))))):o.a.createElement(J.a,{color:"red"},"Not connected"),o.a.createElement(Ue.a,null),d&&o.a.createElement(B.a,{color:"red"},d))},Ze=function(e){var t=e.show,n=e.sensorsConnected,a=e.token,r=e.setToken,l=e.actions,i=e.sensorService;return t?o.a.createElement(H.a,{divided:"vertically"},o.a.createElement(H.a.Row,null,o.a.createElement(H.a.Column,null,o.a.createElement(Xe,{sensorsConnected:n,token:a,actions:l,sensorService:i,setToken:r})))):null},et=n(264),tt=function(e){var t=e.setReloadImage;return o.a.createElement("div",{style:{textAlign:"center"}},o.a.createElement(T.a,{name:"frown",inverted:!0,color:"grey",size:"massive"}),o.a.createElement(J.a,{color:"red",inverted:!0,secondary:!0,compact:!0},o.a.createElement("p",{style:{color:"white"}},"Image failed to load...")),o.a.createElement(z.a,{"data-cy":"error-button",circular:!0,icon:"redo",onClick:Object(y.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(!0);case 2:t(!1);case 3:case"end":return e.stop()}},e)}))}))},nt={height:"100%",background:"black",display:"flex",alignItems:"center",justifyContent:"center"},at=function(e){var t=e.show,n=e.actions,a=Object(r.useState)(o.a.createElement(Ee,{inverted:!1})),l=Object(f.a)(a,2),i=l[0],c=l[1],s=Object(r.useState)("block"),u=Object(f.a)(s,2),m=u[0],d=u[1],g=Object(r.useState)(!1),h=Object(f.a)(g,2),p=h[0],E=h[1];return Object(r.useEffect)(function(){c(o.a.createElement(Ee,{inverted:!1})),d("block")},[t,p]),!t||p?null:o.a.createElement("div",{style:nt},i,n?o.a.createElement(et.a,{style:{maxWidth:800,display:"".concat(m)},centered:!0,src:n.camera,fluid:!0,onLoad:function(){return c(null)},onError:function(){c(o.a.createElement(tt,{setReloadImage:E})),d("none")}}):null)},rt=function(){var e=Object(r.useState)("About"),t=Object(f.a)(e,2),n=t[0],a=t[1],l=Object(r.useState)(JSON.parse(localStorage.getItem("kaste-user-token"))),i=Object(f.a)(l,2),s=i[0],u=i[1],m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:60,t=Object(r.useState)(null),n=Object(f.a)(t,2),a=n[0],o=n[1],l=Object(r.useState)(null),i=Object(f.a)(l,2),s=i[0],u=i[1],m=Object(r.useState)(!1),d=Object(f.a)(m,2),g=d[0],h=d[1],p=Object(r.useState)(null),E=Object(f.a)(p,2),b=E[0],w=E[1],O=Object(r.useState)(null),j=Object(f.a)(O,2),C=j[0],S=j[1],I=Object(c.b)(),A=function(){var e=Object(y.a)(v.a.mark(function e(t){var n,a,r;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,I.query({query:x,variables:{sensorEndpoint:t},fetchPolicy:"no-cache"});case 3:n=e.sent,a=n.data,r=JSON.parse(a.sensorData.value),o(k(r.sensors)),u(r.actions),h(!0),w(null),e.next=17;break;case 12:e.prev=12,e.t0=e.catch(0),h(!1),w(e.t0.message),setTimeout(function(){A(t)},2e3);case 17:case"end":return e.stop()}},e,null,[[0,12]])}));return function(t){return e.apply(this,arguments)}}();return[a,s,{startFetching:function(t){A(t);var n=setInterval(function(){A(t)},1e3*e);S(n)},stopFetching:function(){clearInterval(C),o(null),h(!1),u(null)}},g,b]}(30),d=Object(f.a)(m,5),g=d[0],h=d[1],p=d[2],E=d[3],b=d[4],w=Object(c.b)();Object(r.useEffect)(function(){s&&s.sensorEndpoint?p.startFetching(s.sensorEndpoint):p.stopFetching()},[s]);return o.a.createElement(o.a.Fragment,null,s?o.a.createElement(q,{page:n,setPage:a,logOut:function(){a("Settings"),p.stopFetching(),u(null),localStorage.clear(),w.resetStore()},actions:h,token:s,sensorService:p},o.a.createElement(Se,{token:s,sensorData:g,sensorError:b,show:"Sensors"===n}),o.a.createElement(Le,{show:"Chat"===n}),o.a.createElement(Be,{show:"About"===n}),o.a.createElement(Ze,{show:"Settings"===n,sensorsConnected:E,token:s,setToken:u,actions:h,sensorService:p}),o.a.createElement(at,{show:"Video"===n,token:s,actions:h})):o.a.createElement(le,{setToken:u}))},ot=new h.a({uri:E.wsUrl,options:{reconnect:!0}}),lt=Object(u.b)({uri:E.httpUrl}),it=Object(d.a)(function(e,t){var n=t.headers,r=JSON.parse(localStorage.getItem("kaste-user-token"));return{headers:Object(a.a)({},n,{authorization:r?"bearer ".concat(r.value):null})}}),ct=Object(g.d)(function(e){var t=e.query,n=Object(p.l)(t),a=n.kind,r=n.operation;return"OperationDefinition"===a&&"subscription"===r},ot,it.concat(lt)),st=new s.a({link:ct,cache:new m.a});i.a.render(o.a.createElement(c.a,{client:st},o.a.createElement(rt,null)),document.getElementById("root"))}},[[274,1,2]]]);
//# sourceMappingURL=main.33716ef7.chunk.js.map