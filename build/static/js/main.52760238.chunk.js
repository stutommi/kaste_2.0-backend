(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{208:function(e,t,n){e.exports=n(372)},372:function(e,t,n){"use strict";n.r(t);var a=n(196),r=n(0),l=n.n(r),o=n(50),c=n.n(o),i=n(97),u=n(39),s=n(60),m=n(48),g=n(194),d=n(20),E=n(193),p=n(6),b={wsUrl:"wss://lit-forest-54340.herokuapp.com/graphql",httpUrl:"https://lit-forest-54340.herokuapp.com/graphql"},f=n(27),h=n(172),v=n.n(h),O=n(397),w=n(392),k=n(391),y=n(51),j=n(394),S=n(374),C=function(e){var t=e.children,n=e.setPage,a=e.logOut,o=Object(r.useState)(!1),c=Object(f.a)(o,2),i=c[0],u=c[1],s=Object(r.useState)(!1),m=Object(f.a)(s,2),g=m[0],d=m[1],E=function(e){return function(){d(!1),n(e)}};return l.a.createElement(l.a.Fragment,null,l.a.createElement(O.a,{maxWidth:O.a.onlyMobile.maxWidth,as:w.a.Pushable,style:{minHeight:"100vh"}},l.a.createElement(w.a,{as:k.a,animation:"push",inverted:!0,onHide:function(){return d(!1)},vertical:!0,visible:g,icon:"labeled",width:"thin"},l.a.createElement(k.a.Item,{onClick:E("SensorView")},l.a.createElement(y.a,{name:"info"}),"Sensors"),l.a.createElement(k.a.Item,{onClick:E("ChatView")},l.a.createElement(y.a,{name:"comments outline"}),"Chat"),l.a.createElement(k.a.Item,{disabled:i,onClick:function(){u(!0),console.log("Watering plants plants"),setTimeout(function(){u(!1),console.log("Watering completed")},5e3)}},l.a.createElement(y.a,{name:"exclamation"}),"Water plants"),l.a.createElement(k.a.Item,{onClick:function(){return console.log("Reboot rasp")}},l.a.createElement(y.a,{name:"redo"}),"Reboot rasp"),l.a.createElement(k.a.Item,{onClick:E("AboutView")},l.a.createElement(y.a,{name:"question"}),"About")),l.a.createElement(w.a.Pusher,{dimmed:g},l.a.createElement(j.a,{inverted:!0,textAlign:"center",style:{padding:"0em 0em"},vertical:!0},l.a.createElement(k.a,{inverted:!0,pointing:!0,secondary:!0,color:"green",size:"large"},l.a.createElement(k.a.Item,{onClick:function(){return d(!0)}},l.a.createElement(y.a,{name:"sidebar"})),l.a.createElement(k.a.Item,{position:"right",onClick:function(){return a(!1)}},l.a.createElement(S.a,{primary:!0},"log out")))),t)))},I=function(e){var t=e.children,n=e.setPage,a=e.logOut,o=Object(r.useState)(!1),c=Object(f.a)(o,2),i=c[0],u=c[1],s=function(e){return function(){n(e)}};return l.a.createElement(l.a.Fragment,null,l.a.createElement(O.a,{minWidth:O.a.onlyTablet.minWidth},l.a.createElement(k.a,{inverted:!0,icon:"labeled",color:"green"},l.a.createElement(k.a.Item,{onClick:s("SensorView")},l.a.createElement(y.a,{name:"info"}),"Sensors"),l.a.createElement(k.a.Item,{onClick:s("ChatView")},l.a.createElement(y.a,{name:"comments outline"}),"Chat"),l.a.createElement(k.a.Item,{disabled:i,onClick:function(){u(!0),console.log("Watering plants plants"),setTimeout(function(){u(!1),console.log("Watering completed")},5e3)}},l.a.createElement(y.a,{name:"exclamation"}),"Water plants"),l.a.createElement(k.a.Item,{onClick:function(){return console.log("Reboot rasp")}},l.a.createElement(y.a,{name:"redo"}),"Reboot rasp"),l.a.createElement(k.a.Menu,{position:"right"},l.a.createElement(k.a.Item,{onClick:s("AboutView")},l.a.createElement(y.a,{name:"question"}),"About"),l.a.createElement(k.a.Item,{onClick:function(){return a(!1)}},l.a.createElement(y.a,{name:"log out"}),"Log out"))),t))},x=function(e){var t=e.children,n=e.setPage,a=e.logOut;return l.a.createElement(l.a.Fragment,null,l.a.createElement(C,{logOut:a,setPage:n},t),l.a.createElement(I,{logOut:a,setPage:n},t))},A=n(120),P=n.n(A),W=n(179),V=n(393),T=n(395),q=n(385),R=n(389),U=n(381),M=n(62),$=n(49);function z(){var e=Object(M.a)(["\nmutation loginUser(\n  $password: String!\n  $username: String!\n  ) {\n  login(\n    password: $password\n    username: $username\n  ) {\n    value\n    username\n  }\n}\n"]);return z=function(){return e},e}var F=Object($.a)(z()),J=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=Object(r.useState)(null),n=Object(f.a)(t,2),a=n[0],l=n[1];return[a,function(t){l(t),setTimeout(function(){l(null)},1e3*e)}]},L=function(e){var t=e.setToken,n=Object(U.a)(F),a=J(),o=Object(f.a)(a,2),c=o[0],i=o[1],u=Object(r.useState)(""),s=Object(f.a)(u,2),m=s[0],g=s[1],d=Object(r.useState)(""),E=Object(f.a)(d,2),p=E[0],b=E[1],h=function(){var e=Object(W.a)(P.a.mark(function e(){var a,r;return P.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n({variables:{username:m,password:p}});case 3:a=e.sent,r=a.data.login,console.log("token",r),t(r),localStorage.setItem("kaste-user-token",JSON.stringify(r)),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),i(e.t0.graphQLErrors[0].message);case 13:case"end":return e.stop()}},e,null,[[0,10]])}));return function(){return e.apply(this,arguments)}}();return l.a.createElement("div",{className:"login-form"},l.a.createElement("style",null," ","\n  body > div,\n  body > div > div,\n  body > div > div > div.login-form {\n    height: 100%;\n  }\n          "),l.a.createElement(V.a,{textAlign:"center",style:{height:"100%",background:"lightgreen"},verticalAlign:"middle"},l.a.createElement(V.a.Column,{style:{maxWidth:250}},l.a.createElement(T.a,{as:"h1",color:"grey",dividing:!0,textAlign:"center"},"Log in to Kaste 2.0"),l.a.createElement(q.a,{size:"large",onSubmit:h},l.a.createElement(j.a,{stacked:!0,raised:!0},l.a.createElement(q.a.Input,{type:"text",value:m,onChange:function(e){var t=e.target;return g(t.value)},fluid:!0,icon:"user",iconPosition:"left",placeholder:"Username"}),l.a.createElement(q.a.Input,{type:"password",value:p,onChange:function(e){var t=e.target;return b(t.value)},fluid:!0,icon:"lock",iconPosition:"left",placeholder:"Password"}),l.a.createElement(S.a,{color:"brown",size:"large",type:"submit"},"Log in")),c&&l.a.createElement(R.a,{negative:!0},c)))))},N=function(e){return e.show?l.a.createElement("p",null,"SENSORVIEW"):null},D=n(384),K=n(386),Q=n(382),H=n(388);function B(){var e=Object(M.a)(["\n{\n  messages {\n    content\n    created\n    id\n    user {\n      name\n    }\n  }\n}\n"]);return B=function(){return e},e}var G=Object($.a)(B());function _(){var e=Object(M.a)(["\nmutation createMessage(\n  $content: String!\n  ) {\n  createMessage(\n    content: $content\n  ) {\n    content\n    user {\n      name\n    }\n    created\n    id\n  }\n}\n"]);return _=function(){return e},e}var X=Object($.a)(_()),Y=function(e){var t=e.message;return l.a.createElement(K.a,null,l.a.createElement(K.a.Content,null,l.a.createElement(K.a.Author,{as:"a"},t.user.name),l.a.createElement(K.a.Metadata,null,l.a.createElement("div",null,new Date(parseInt(t.created)).toUTCString())),l.a.createElement(j.a,{style:{marginTop:0,padding:7},compact:!0,inverted:!0,color:"green",secondary:!0},t.content)))},Z=n(390),ee=n(383),te=function(){return l.a.createElement(Z.a,{active:!0,inverted:!0},l.a.createElement(ee.a,{size:"massive",inverted:!0},"Loading"))},ne=function(e,t){return e.map(function(e){return e.id}).includes(t.id)},ae=function(e){var t=e.show,n=Object(H.a)(G),a=n.data,o=n.loading,c=Object(r.useState)(""),u=Object(f.a)(c,2),s=u[0],m=u[1],g=Object(i.b)(),d=Object(U.a)(X,{update:function(e,t){var n=e.readQuery({query:G}),a=t.data.createMessage;console.log("messageData",n),ne(n.messages,a.id)||(n.messages.push(a),console.log("1"),g.writeQuery({query:G,data:n,id:1}),console.log("2"))}}),E=function(){s.length<1||(d({variables:{content:s}}),m(""))};return t?l.a.createElement("div",null,l.a.createElement(D.a,null,o?l.a.createElement(te,null):l.a.createElement(K.a.Group,null,l.a.createElement(T.a,{textAlign:"center",as:"h3",dividing:!0},"Chat"),a.messages.map(function(e){return l.a.createElement(Y,{key:e.id,message:e})}))),l.a.createElement(k.a,{fluid:!0,color:"grey"},l.a.createElement(k.a.Item,{style:{width:"70%"}},l.a.createElement(Q.a,{fluid:!0,value:s,onChange:function(e){var t=e.target;return m(t.value)},onKeyPress:function(e){"Enter"===e.key&&E()}})),l.a.createElement(k.a.Item,{position:"right"},l.a.createElement(S.a,{primary:!0,type:"submit",onClick:E},"Send")))):null},re=n(387),le=function(e){return e.show?l.a.createElement(D.a,{textAlign:"center"},l.a.createElement(T.a,{as:"h1",style:{padding:25}},"About Kaste 2.0"),l.a.createElement(re.a,{style:{background:"lightgreen"}},l.a.createElement("tbody",null,l.a.createElement("tr",null,l.a.createElement("td",null,"Aim:"),l.a.createElement("td",null,"Design and implement a responsive web app to monitor and water plants.")),l.a.createElement("tr",null,l.a.createElement("td",null,"Features:"),l.a.createElement("td",null,l.a.createElement("ul",null,l.a.createElement("li",null,"Plantwatering functionality for two or more users"),l.a.createElement("li",null,"Possibility to read plant info through charts"),l.a.createElement("li",null,"Simple chat"),l.a.createElement("li",null,"Rebooting Raspberry (that controls sensor data)"))))))):null},oe=function(){var e=Object(r.useState)("SensorView"),t=Object(f.a)(e,2),n=t[0],a=t[1],o=Object(r.useState)(JSON.parse(localStorage.getItem("kaste-user-token"))),c=Object(f.a)(o,2),i=c[0],u=c[1];Object(r.useEffect)(function(){v.a.get("http://86.115.57.126:8001/ws/pasila_sensors").then(function(e){return console.log(e)})},[]);return l.a.createElement(l.a.Fragment,null,i?l.a.createElement(x,{setPage:a,logOut:function(){u(null),localStorage.removeItem("kaste-user-token")}},l.a.createElement(N,{show:"SensorView"===n}),l.a.createElement(ae,{show:"ChatView"===n}),l.a.createElement(le,{show:"AboutView"===n})):l.a.createElement(L,{setToken:u}))},ce=new E.a({uri:b.wsUrl,options:{reconnect:!0}}),ie=Object(s.b)({uri:b.httpUrl}),ue=Object(g.a)(function(e,t){var n=t.headers,r=JSON.parse(localStorage.getItem("kaste-user-token"));return console.log("token",r),{headers:Object(a.a)({},n,{authorization:r?"bearer ".concat(r.value):null})}}),se=Object(d.d)(function(e){var t=e.query,n=Object(p.l)(t),a=n.kind,r=n.operation;return"OperationDefinition"===a&&"subscription"===r},ce,ue.concat(ie)),me=new u.a({link:se,cache:new m.a});c.a.render(l.a.createElement(i.a,{client:me},l.a.createElement(oe,null)),document.getElementById("root"))}},[[208,1,2]]]);
//# sourceMappingURL=main.52760238.chunk.js.map