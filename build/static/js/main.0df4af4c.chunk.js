(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{215:function(e,t,n){e.exports=n(381)},381:function(e,t,n){"use strict";n.r(t);var a=n(107),r=n(0),l=n.n(r),o=n(57),c=n.n(o),i=n(69),s=n(45),u=n(66),m=n(56),d=n(202),g=n(21),E=n(201),b=n(6),p={wsUrl:"wss://lit-forest-54340.herokuapp.com/graphql",httpUrl:"https://lit-forest-54340.herokuapp.com/graphql"},f=n(19),h=n(35),v=n.n(h),y=n(46),O=n(67),k=n.n(O),j=function(e,t){return e.map(function(e){return e.id}).includes(t.id)},C=function(e){return Object.values(e).reduce(function(e,t){return t.concat(e)})},w=function(e,t){var n=JSON.parse(localStorage.getItem("kaste-user-token"));localStorage.removeItem("kaste-user-token");var r=Object(a.a)({},n,{sensorEndpoint:e});window.localStorage.setItem("kaste-user-token",JSON.stringify(r)),t(r)},S=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=Object(r.useState)(null),n=Object(f.a)(t,2),a=n[0],l=n[1];return[a,function(t){l(t),setTimeout(function(){l(null)},1e3*e)}]},x=n(408),I=n(405),A=n(401),R=n(58),T=function(e){var t=e.children,n=e.setPage,a=e.logOut,o=e.page,c=e.actions,i=e.token,s=Object(r.useState)(!1),u=Object(f.a)(s,2),m=u[0],d=u[1],g=Object(r.useState)(!1),E=Object(f.a)(g,2),b=E[0],p=E[1],h=Object(r.useState)(!1),v=Object(f.a)(h,2),y=v[0],O=v[1],j=Object(r.useState)(!1),C=Object(f.a)(j,2),w=C[0],S=C[1],T=Object(r.useState)(!1),D=Object(f.a)(T,2),z=D[0],W=D[1],P=function(e){return function(){p(!1),n(e)}};console.log(c),Object(r.useEffect)(function(){c?(O(void 0!==c.camera),S(void 0!==c.reboot),W(void 0!==c.water)):(O(!1),S(!1),W(!1))},[c]);return l.a.createElement(l.a.Fragment,null,l.a.createElement(x.a,{maxWidth:x.a.onlyMobile.maxWidth,as:I.a.Pushable,style:{height:"100vh"}},l.a.createElement(I.a,{as:A.a,animation:"push",inverted:!0,onHide:function(){return p(!1)},vertical:!0,visible:b,icon:"labeled",width:"thin"},i&&l.a.createElement(A.a.Header,{as:"small",style:{color:"white"}},l.a.createElement(R.a,{name:"user",color:"green"}),i.username),l.a.createElement(A.a.Item,{onClick:P("Sensors")},l.a.createElement(R.a,{name:"info"}),"Sensors"),l.a.createElement(A.a.Item,{onClick:P("Chat")},l.a.createElement(R.a,{name:"comments outline"}),"Chat"),l.a.createElement(A.a.Item,{onClick:P("Settings")},l.a.createElement(R.a,{name:"settings"}),"Settings"),l.a.createElement(A.a.Item,{onClick:P("About")},l.a.createElement(R.a,{name:"question"}),"About"),l.a.createElement(A.a.Item,{disabled:!y,onClick:P("Video")},l.a.createElement(R.a,{name:"eye"}),"Live Feed"),l.a.createElement(A.a.Item,{disabled:!z||m,onClick:function(){d(!0),console.log("Watering plants plants");try{k.a.get(c.water.oneMin)}catch(e){console.error(e.message)}setTimeout(function(){d(!1),console.log("Watering completed")},6e4)}},l.a.createElement(R.a,{name:"shower"}),"Water plants"),l.a.createElement(A.a.Item,{disabled:!w,onClick:function(){return console.log("Reboot rasp")}},l.a.createElement(R.a,{name:"redo"}),"Reboot rasp")),l.a.createElement(I.a.Pusher,{style:{height:"100%"},dimmed:b},l.a.createElement(A.a,{widths:3,inverted:!0,pointing:!0,color:"green",size:"large",style:{height:"50px",marginBottom:0,borderRadius:0}},l.a.createElement(A.a.Item,{onClick:function(){return p(!0)},style:{alignSelf:"center"}},l.a.createElement(R.a,{name:"sidebar"})),l.a.createElement(A.a.Item,{header:!0},o),l.a.createElement(A.a.Item,{position:"right",onClick:function(){return a()},style:{alignSelf:"center"}},l.a.createElement(R.a,{name:"log out"}))),l.a.createElement("div",{style:{height:"calc(100vh - 50px)"}},t))))},D=function(e){var t=e.children,n=e.setPage,a=e.logOut,o=Object(r.useState)(!1),c=Object(f.a)(o,2),i=c[0],s=c[1],u=function(e){return function(){n(e)}};return l.a.createElement(l.a.Fragment,null,l.a.createElement(x.a,{style:{height:"100vh"},minWidth:x.a.onlyTablet.minWidth},l.a.createElement(A.a,{style:{height:71},inverted:!0,icon:"labeled",color:"green",fixed:"top"},l.a.createElement(A.a.Item,{onClick:u("Sensors")},l.a.createElement(R.a,{name:"info"}),"Sensors"),l.a.createElement(A.a.Item,{onClick:u("Chat")},l.a.createElement(R.a,{name:"comments outline"}),"Chat"),l.a.createElement(A.a.Item,{disabled:i,onClick:function(){s(!0),console.log("Watering plants plants"),setTimeout(function(){s(!1),console.log("Watering completed")},5e3)}},l.a.createElement(R.a,{name:"exclamation"}),"Water plants"),l.a.createElement(A.a.Item,{onClick:function(){return console.log("Reboot rasp")}},l.a.createElement(R.a,{name:"redo"}),"Reboot rasp"),l.a.createElement(A.a.Item,{onClick:u("Video")},l.a.createElement(R.a,{name:"eye"}),"Live Feed"),l.a.createElement(A.a.Menu,{position:"right"},l.a.createElement(A.a.Item,{onClick:u("Settings")},l.a.createElement(R.a,{name:"settings"}),"Settings"),l.a.createElement(A.a.Item,{onClick:u("About")},l.a.createElement(R.a,{name:"question"}),"About"),l.a.createElement(A.a.Item,{onClick:function(){return a(!1)}},l.a.createElement(R.a,{name:"log out"}),"Log out"))),l.a.createElement("div",{style:{height:71}}),l.a.createElement("div",{style:{height:"calc(100vh - 71px)"}},t)))},z=function(e){var t=e.children,n=e.setPage,a=e.logOut,r=e.page,o=e.actions,c=e.token;return l.a.createElement(l.a.Fragment,null,l.a.createElement(T,{logOut:a,page:r,actions:o,setPage:n,token:c},t),l.a.createElement(D,{logOut:a,setPage:n,actions:o},t))},W=n(403),P=n(402),U=n(396),F=n(407),M=n(383),L=n(400),$=n(390),B=n(30),Y=n(31);function H(){var e=Object(B.a)(["\nmutation loginUser(\n  $password: String!\n  $username: String!\n  ) {\n  login(\n    password: $password\n    username: $username\n  ) {\n    value\n    username\n    sensorEndpoint\n  }\n}\n"]);return H=function(){return e},e}var N=Object(Y.a)(H());function _(){var e=Object(B.a)(["\n{\n  me {\n    name\n    username\n    id\n    sensorEndpoint\n  }\n}\n"]);return _=function(){return e},e}var q=Object(Y.a)(_()),J=function(e){var t=e.setToken,n=Object($.a)(N),a=S(),o=Object(f.a)(a,2),c=o[0],i=o[1],s=Object(r.useState)(""),u=Object(f.a)(s,2),m=u[0],d=u[1],g=Object(r.useState)(""),E=Object(f.a)(g,2),b=E[0],p=E[1],h=function(){var e=Object(y.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n({update:function(e,n){var a=n.data.login;t(a),localStorage.setItem("kaste-user-token",JSON.stringify(a))},variables:{username:m,password:b},refetchQueries:[{query:q}]});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),i(e.t0.graphQLErrors[0].message);case 8:case"end":return e.stop()}},e,null,[[0,5]])}));return function(){return e.apply(this,arguments)}}();return l.a.createElement("div",{className:"login-form"},l.a.createElement("style",null," ","\n  body > div,\n  body > div > div,\n  body > div > div > div.login-form {\n    height: 100%;\n  }\n          "),l.a.createElement(W.a,{textAlign:"center",style:{height:"100%",background:"lightgreen"},verticalAlign:"middle"},l.a.createElement(W.a.Column,{style:{maxWidth:250}},l.a.createElement(P.a,{as:"h1",color:"grey",dividing:!0,textAlign:"center"},"Log in to Kaste 2.0"),l.a.createElement(U.a,{size:"large",onSubmit:h},l.a.createElement(F.a,{stacked:!0,raised:!0},l.a.createElement(U.a.Input,{type:"text",value:m,onChange:function(e){var t=e.target;return d(t.value)},fluid:!0,icon:"user",iconPosition:"left",placeholder:"Username"}),l.a.createElement(U.a.Input,{type:"password",value:b,onChange:function(e){var t=e.target;return p(t.value)},fluid:!0,icon:"lock",iconPosition:"left",placeholder:"Password"}),l.a.createElement(M.a,{color:"brown",size:"large",type:"submit"},"Log in")),c&&l.a.createElement(L.a,{negative:!0},c)))))},K=function(e){var t=e.value,n=(e.label,e.icon),a=e.iconColor,r=e.size;return l.a.createElement("div",null,l.a.createElement(R.a,{name:n,size:r,color:a||null}),l.a.createElement("span",{style:{fontSize:"".concat("big"===r?"28px":"11px"),verticalAlign:"middle"}},t))},V=n(404),Q=n(199),G=n(79),X=n.n(G);function Z(){var e=Object(B.a)(["\n  query ChartData($id: Int!, $type: HousePlant!, $range: DayWeekMonthYear!) {\n  chartData(id: $id, type: $type, range: $range) {\n    time\n    light\n    nutrient\n    soilMoisture\n    temperatureC\n    humidity\n  }\n}\n"]);return Z=function(){return e},e}var ee=Object(Y.a)(Z()),te=n(399),ne=n(392),ae=function(){return l.a.createElement(te.a,{active:!0},l.a.createElement(ne.a,{size:"massive"},"Loading"))},re={layout:{padding:{bottom:-20}},scales:{xAxes:[{ticks:{autoSkip:!0,maxTicksLimit:5}}],yAxes:[{ticks:{min:0,max:100}}]}},le=function(e){var t=e.sensor,n=e.chartTimeRange,a=Object(V.a)(ee,{variables:{id:t.id,type:t.type.toUpperCase(),range:n},fetchPolicy:"no-cache"});if(a.loading)return l.a.createElement(ae,null);var r=function(e){var t=e.chartData,n=Object.keys(t).reduce(function(e,n){if("__typename"===n||null===t[n])return e;if("time"===n)return e.labels=t[n].map(function(e){return X()()-e>864e5?X.a.utc(e).local().format("ddd hA"):X()(e).subtract(3,"hours").fromNow(!0)}),e;var a=function(e){switch(e){case"temperatureC":return"rgba(250, 64, 61, 0.7)";case"nutrient":return"rgba(250, 158, 61, 0.7)";case"light":return"rgba(246, 250, 61, 0.7)";case"humidity":case"soilMoisture":return"rgba(61, 152, 250, 0.7)"}};return e.datasets.push({label:n,fill:!1,lineTension:.1,backgroundColor:a(n),borderColor:a(n),borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",pointBorderColor:a(n),pointBackgroundColor:"#fff",pointBorderWidth:1,pointHoverRadius:5,pointHoverBackgroundColor:a(n),pointHoverBorderColor:a(n),pointHoverBorderWidth:2,pointRadius:1,pointHitRadius:10,data:t[n]}),e},{labels:[],datasets:[]});return console.log("formattedChartData",n),n}(a.data);return l.a.createElement(Q.a,{data:r,options:re,legend:{display:!1}})},oe=function(e){var t=e.sensor,n=Object(r.useState)(!1),a=Object(f.a)(n,2),o=a[0],c=a[1],i=Object(r.useState)("DAY"),s=Object(f.a)(i,2),u=s[0],m=s[1];return l.a.createElement(F.a,{color:"green",inverted:!0,secondary:!0,style:{margin:"2px 1px"}},l.a.createElement(P.a,{textAlign:"center",as:"h3"},l.a.createElement(R.a,{name:"leaf",size:"large"}),"Capsicum baccatum"),l.a.createElement(W.a,{textAlign:"center",columns:2},l.a.createElement(W.a.Row,null,l.a.createElement(W.a.Column,{color:t.soil_moisture<10?"yellow":null},l.a.createElement(K,{size:"big",value:t.soil_moisture+" %",label:"Soil moisture",icon:"theme",iconColor:"blue"})),l.a.createElement(W.a.Column,null,l.a.createElement(K,{size:"big",value:Math.floor(t.light)+" %",label:"Light",icon:"sun",iconColor:"yellow"}))),l.a.createElement(W.a.Row,null,l.a.createElement(W.a.Column,null,l.a.createElement(K,{size:"big",value:t.temperature_C+" \xbaC",label:"Temperature",icon:"thermometer",iconColor:"red"})),l.a.createElement(W.a.Column,null,l.a.createElement(K,{size:"big",value:Math.floor(t.nutrient)+" %",label:"Nutrient",icon:"pills",iconColor:"orange"}))),l.a.createElement(W.a.Row,{columns:"1",style:{padding:0}},l.a.createElement(W.a.Column,{textAlign:"center"},l.a.createElement(M.a,{circular:!0,icon:o?"close":"chart area",onClick:function(){return c(!o)}}),o&&l.a.createElement(l.a.Fragment,null,l.a.createElement(M.a,{circular:!0,onClick:function(){return m("DAY")}},"D"),l.a.createElement(M.a,{circular:!0,onClick:function(){return m("WEEK")}},"W"),l.a.createElement(M.a,{circular:!0,onClick:function(){return m("MONTH")}},"M"),l.a.createElement(M.a,{circular:!0,onClick:function(){return m("YEAR")}},"Y")))),l.a.createElement(W.a.Row,{columns:1,style:{padding:"".concat(o?"5px":"0px")}},l.a.createElement(W.a.Column,{style:{padding:0}},l.a.createElement(F.a,{style:{display:"".concat(o?"block":"none"),padding:5}},l.a.createElement(le,{sensor:t,chartTimeRange:u})))),l.a.createElement(W.a.Row,{columns:2,style:{padding:5}},l.a.createElement(W.a.Column,{textAlign:"left"},l.a.createElement(K,{value:t.time,label:"Updated",size:"small",icon:"time",iconColor:Date.now()-new Date(t.time).getTime()>36e5?"red":null})),l.a.createElement(W.a.Column,{textAlign:"right"},l.a.createElement(K,{value:t.battery_low+" %",label:"Battery",size:"small",icon:"battery full",iconColor:t.battery_low<30?"red":null})))))},ce=function(e){var t=e.sensor,n=Object(r.useState)(!1),a=Object(f.a)(n,2),o=a[0],c=a[1],i=Object(r.useState)("DAY"),s=Object(f.a)(i,2),u=s[0],m=s[1];return l.a.createElement(F.a,{inverted:!0,secondary:!0,style:{margin:"2px 1px",background:"beige",color:"black"}},l.a.createElement(P.a,{style:{color:"black"},textAlign:"center",as:"h3"},l.a.createElement(R.a,{name:"home",color:"black",size:"large"}),t.location),l.a.createElement(W.a,{textAlign:"center",columns:2},l.a.createElement(W.a.Row,null,l.a.createElement(W.a.Column,{color:t.soil_moisture<30?"yellow":null},l.a.createElement(K,{size:"big",value:t.humidity+" %",label:"Soil moisture",icon:"theme",iconColor:"blue"})),l.a.createElement(W.a.Column,null,l.a.createElement(K,{size:"big",value:t.temperature_C+" \xbaC",label:"Temperature",icon:"thermometer",iconColor:"red"}))),l.a.createElement(W.a.Row,{columns:"1",style:{padding:0}},l.a.createElement(W.a.Column,{textAlign:"center"},l.a.createElement(M.a,{circular:!0,icon:o?"close":"chart area",onClick:function(){return c(!o)}}),o&&l.a.createElement(l.a.Fragment,null,l.a.createElement(M.a,{circular:!0,onClick:function(){return m("DAY")}},"D"),l.a.createElement(M.a,{circular:!0,onClick:function(){return m("WEEK")}},"W"),l.a.createElement(M.a,{circular:!0,onClick:function(){return m("MONTH")}},"M"),l.a.createElement(M.a,{circular:!0,onClick:function(){return m("YEAR")}},"Y")))),l.a.createElement(W.a.Row,{columns:1,style:{padding:"".concat(o?"5px":"0px")}},l.a.createElement(W.a.Column,{style:{padding:0}},l.a.createElement(F.a,{style:{display:"".concat(o?"block":"none"),padding:5}},l.a.createElement(le,{sensor:t,chartTimeRange:u})))),l.a.createElement(W.a.Row,{columns:2,style:{padding:5}},l.a.createElement(W.a.Column,{textAlign:"left"},l.a.createElement(K,{value:t.time,label:"Updated",size:"small",icon:"time",iconColor:Date.now()-new Date(t.time).getTime()>36e5?"red":null})),l.a.createElement(W.a.Column,{textAlign:"right"},l.a.createElement(K,{label:"Battery",size:"small",icon:"battery full",iconColor:1===t.battery_low?"red":null})))))},ie=function(e){var t=e.show,n=e.sensorData;if(!t)return null;return l.a.createElement("div",{style:{height:"100%",overflowY:"scroll"}},n?n.map(function(e){return"plant"===e.type?l.a.createElement(oe,{key:e.id,sensor:e}):l.a.createElement(ce,{key:e.id,sensor:e})}):null)},se=n(394),ue=n(395),me=n(397),de=n(391);function ge(){var e=Object(B.a)(["\n{\n  messages {\n    content\n    created\n    id\n    user {\n      name\n    }\n  }\n}\n"]);return ge=function(){return e},e}var Ee=Object(Y.a)(ge());function be(){var e=Object(B.a)(["\nmutation createMessage(\n  $content: String!\n  ) {\n  createMessage(\n    content: $content\n  ) {\n    content\n    user {\n      name\n    }\n    created\n    id\n  }\n}\n"]);return be=function(){return e},e}var pe=Object(Y.a)(be());function fe(){var e=Object(B.a)(["\nsubscription {\n  messageAdded {\n    content\n    created\n    id\n    user {\n      name\n    }\n  }\n}\n"]);return fe=function(){return e},e}var he=Object(Y.a)(fe()),ve=n(393),ye=function(e){var t=e.message,n=e.currentUser;if(!n.me)return null;var a=n.me.name===t.user.name?"blue":"green",r=n.me.name===t.user.name?"left":"right",o={margin:"0 0 5px 0",padding:7,float:"".concat(r),clear:"both"};return l.a.createElement(me.a,{style:{marginTop:7,paddingTop:7,overflow:"auto"}},l.a.createElement(F.a,{style:o,compact:!0,inverted:!0,color:a,secondary:!0},l.a.createElement(me.a.Content,null,l.a.createElement(me.a.Author,{as:"a"},t.user.name),l.a.createElement(me.a.Metadata,null,l.a.createElement("div",null,new Date(parseInt(t.created)).toLocaleString())),l.a.createElement(ve.a,{style:{margin:"4px 0px 4px 0px"}}),t.content)))},Oe=function(e){var t=e.show,n=Object(V.a)(Ee),a=n.data,o=n.loading,c=Object(V.a)(q),i=Object(r.useState)(""),s=Object(f.a)(i,2),u=s[0],m=s[1],d=Object(r.useRef)(null);Object(r.useEffect)(function(){E()},[t]);var g=Object($.a)(pe),E=(Object(se.a)(he,{onSubscriptionData:function(e){var t=e.client,n=e.subscriptionData,a=t.readQuery({query:Ee}),r=n.data.messageAdded;j(a.messages,r.id)||(a.messages.push(r),t.writeQuery({query:Ee,data:a,id:1}),d.current.scrollIntoView({block:"end",behavior:"smooth"}))}}),function(){d.current&&d.current.scrollIntoView({block:"end",behavior:"smooth"})}),b=function(){u.length<1||(g({variables:{content:u}}),m(""))};return t?l.a.createElement("div",{style:{height:"100%"}},l.a.createElement(ue.a,{style:{height:"90%",overflowY:"scroll"}},o||c.loading?l.a.createElement(ae,null):l.a.createElement(me.a.Group,null,a.messages.map(function(e){return l.a.createElement(ye,{key:e.id,message:e,currentUser:c.data})})),l.a.createElement("div",{id:"el",ref:d})),l.a.createElement(A.a,{fluid:!0,color:"grey",style:{marginBottom:0,marginTop:0,height:"10%"}},l.a.createElement(A.a.Item,{style:{width:"80vw"}},l.a.createElement(de.a,{fluid:!0,value:u,onChange:function(e){var t=e.target;return m(t.value)},onKeyPress:function(e){"Enter"===e.key&&b()},onFocus:E})),l.a.createElement(A.a.Item,{style:{width:"20vw",justifyContent:"center"},onClick:b},l.a.createElement(R.a,{name:"send",inverted:!0,circular:!0,color:"green"})))):null},ke=n(398),je=function(e){return e.show?l.a.createElement(ue.a,{textAlign:"center"},l.a.createElement(P.a,{as:"h1",style:{padding:25}},"About Kaste 2.0"),l.a.createElement(ke.a,{style:{background:"lightgreen"}},l.a.createElement("tbody",null,l.a.createElement("tr",null,l.a.createElement("td",null,"Aim:"),l.a.createElement("td",null,"Design and implement a responsive web app to monitor and water plants.")),l.a.createElement("tr",null,l.a.createElement("td",null,"Features:"),l.a.createElement("td",null,l.a.createElement("ul",null,l.a.createElement("li",null,"Plantwatering functionality for two or more users"),l.a.createElement("li",null,"Possibility to read plant info through charts"),l.a.createElement("li",null,"Simple chat"),l.a.createElement("li",null,"Rebooting Raspberry (that controls sensor data)"))))))):null};function Ce(){var e=Object(B.a)(["\nmutation editUserSensorEndpoint(\n  $sensorEndpoint: String!\n  ) {\n    editUserSensorEndpoint(\n    sensorEndpoint: $sensorEndpoint\n  ) {\n    sensorEndpoint\n    name\n    username\n  }\n}\n"]);return Ce=function(){return e},e}var we=Object(Y.a)(Ce()),Se=function(e){var t=e.sensorsConnected,n=e.token,a=e.setToken,o=Object(r.useState)(""),c=Object(f.a)(o,2),i=c[0],s=c[1],u=S(),m=Object(f.a)(u,2),d=m[0],g=m[1],E=Object($.a)(we),b=function(){var e=Object(y.a)(v.a.mark(function e(){var t;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.a.get(i);case 3:t=e.sent,Object.keys(t.data).includes("sensors")&&window.confirm("Would you like to receive information about these sensors?")&&(E({variables:{sensorEndpoint:i}}),w(i,a),s("")),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),g(e.t0.message);case 11:case"end":return e.stop()}},e,null,[[0,8]])}));return function(){return e.apply(this,arguments)}}();return l.a.createElement(F.a,null,l.a.createElement(P.a,null,"Sensor resource URL"),l.a.createElement("small",{style:{color:"gray"}},"Provide an endpoint URL where sensor output comes from"),l.a.createElement(de.a,{value:i,onChange:function(e){var t=e.target;return s(t.value)},fluid:!0,placeholder:"Enter URL...",action:l.a.createElement(M.a,{loading:!1,onClick:b},"connect")}),t?l.a.createElement(F.a,{color:"green"},l.a.createElement(P.a,{as:"h3"},"connected at:"),n.sensorEndpoint,l.a.createElement(M.a,{fluid:!0,style:{marginTop:10},onClick:function(){window.confirm("Are you sure? Clearing sensor resource url cuts access to all information and functionality.")&&(E({variables:{sensorEndpoint:""}}),w("",a))}},"clear")):l.a.createElement(F.a,{color:"red"},"not connected"),l.a.createElement(ve.a,null),d&&l.a.createElement(L.a,{color:"red"},d))},xe=function(e){var t=e.show,n=e.sensorsConnected,a=e.token,r=e.setToken;return t?l.a.createElement(W.a,{divided:"vertically"},l.a.createElement(W.a.Row,null,l.a.createElement(W.a.Column,null,l.a.createElement(Se,{sensorsConnected:n,token:a,setToken:r})))):null},Ie=n(203),Ae=function(e){var t=e.setReloadImage;return l.a.createElement("div",{style:{textAlign:"center"}},l.a.createElement(R.a,{name:"frown",inverted:!0,color:"grey",size:"massive"}),l.a.createElement(F.a,{color:"red",inverted:!0,secondary:!0,compact:!0},l.a.createElement("p",{style:{color:"white"}},"Image failed to load...")),l.a.createElement(M.a,{circular:!0,icon:"redo",onClick:Object(y.a)(v.a.mark(function e(){return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(!0);case 2:t(!1);case 3:case"end":return e.stop()}},e)}))}))},Re={height:"100%",background:"black",display:"flex",alignItems:"center",justifyContent:"center"},Te=function(e){var t=e.show,n=e.actions,a=Object(r.useState)(l.a.createElement(ae,null)),o=Object(f.a)(a,2),c=o[0],i=o[1],s=Object(r.useState)("block"),u=Object(f.a)(s,2),m=u[0],d=u[1],g=Object(r.useState)(!1),E=Object(f.a)(g,2),b=E[0],p=E[1];return Object(r.useEffect)(function(){i(l.a.createElement(ae,null)),d("block")},[t,b]),!t||b?null:l.a.createElement("div",{style:Re},c,n?l.a.createElement(Ie.a,{style:{maxWidth:800,display:"".concat(m)},centered:!0,src:n.camera,fluid:!0,onLoad:function(){return i(null)},onError:function(){i(l.a.createElement(Ae,{setReloadImage:p})),d("none")}}):null)},De=function(){var e=Object(r.useState)("Sensors"),t=Object(f.a)(e,2),n=t[0],a=t[1],o=Object(r.useState)(JSON.parse(localStorage.getItem("kaste-user-token"))),c=Object(f.a)(o,2),s=c[0],u=c[1],m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:60,t=Object(r.useState)(null),n=Object(f.a)(t,2),a=n[0],l=n[1],o=Object(r.useState)(null),c=Object(f.a)(o,2),i=c[0],s=c[1],u=Object(r.useState)(!1),m=Object(f.a)(u,2),d=m[0],g=m[1],E=S(null),b=Object(f.a)(E,2),p=b[0],h=b[1],O=Object(r.useState)(null),j=Object(f.a)(O,2),w=j[0],x=j[1],I=function(){var e=Object(y.a)(v.a.mark(function e(t){var n;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.a.get(t);case 3:n=e.sent,l(C(n.data.sensors)),s(n.data.actions),g(!0),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),g(!1),h(e.t0);case 13:case"end":return e.stop()}},e,null,[[0,9]])}));return function(t){return e.apply(this,arguments)}}();return[a,i,{startFetching:function(t){console.log("fetching..."),I(t);var n=setInterval(function(){console.log("fetching..."),I(t)},1e3*e);x(n)},stopFetching:function(){console.log("IntervalId",w),clearInterval(w),l(null),g(!1),s(null)}},d,p]}(60),d=Object(f.a)(m,5),g=d[0],E=d[1],b=d[2],p=d[3],h=(d[4],Object(i.b)());Object(r.useEffect)(function(){s&&s.sensorEndpoint?b.startFetching(s.sensorEndpoint):b.stopFetching()},[s]);return l.a.createElement(l.a.Fragment,null,s?l.a.createElement(z,{page:n,setPage:a,logOut:function(){a("Settings"),b.stopFetching(),u(null),localStorage.clear(),h.resetStore()},actions:E,token:s},l.a.createElement(ie,{sensorData:g,show:"Sensors"===n}),l.a.createElement(Oe,{show:"Chat"===n}),l.a.createElement(je,{show:"About"===n}),l.a.createElement(xe,{show:"Settings"===n,sensorsConnected:p,token:s,setToken:u}),l.a.createElement(Te,{show:"Video"===n,token:s,actions:E})):l.a.createElement(J,{setToken:u}))},ze=new E.a({uri:p.wsUrl,options:{reconnect:!0}}),We=Object(u.b)({uri:p.httpUrl}),Pe=Object(d.a)(function(e,t){var n=t.headers,r=JSON.parse(localStorage.getItem("kaste-user-token"));return{headers:Object(a.a)({},n,{authorization:r?"bearer ".concat(r.value):null})}}),Ue=Object(g.d)(function(e){var t=e.query,n=Object(b.l)(t),a=n.kind,r=n.operation;return"OperationDefinition"===a&&"subscription"===r},ze,Pe.concat(We)),Fe=new s.a({link:Ue,cache:new m.a});c.a.render(l.a.createElement(i.a,{client:Fe},l.a.createElement(De,null)),document.getElementById("root"))}},[[215,1,2]]]);
//# sourceMappingURL=main.0df4af4c.chunk.js.map