(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{210:function(e,t,n){e.exports=n(374)},374:function(e,t,n){"use strict";n.r(t);var a=n(104),r=n(0),l=n.n(r),c=n(56),o=n.n(c),i=n(67),s=n(45),u=n(64),m=n(55),d=n(198),E=n(21),g=n(197),b=n(6),f={wsUrl:"wss://lit-forest-54340.herokuapp.com/graphql",httpUrl:"https://lit-forest-54340.herokuapp.com/graphql"},p=n(20),v=n(35),h=n.n(v),O=n(46),y=n(95),j=n.n(y),k=function(e,t){return e.map(function(e){return e.id}).includes(t.id)},w=function(e){return Object.values(e).reduce(function(e,t){return t.concat(e)})},S=function(e,t){var n=JSON.parse(localStorage.getItem("kaste-user-token"));localStorage.removeItem("kaste-user-token");var r=Object(a.a)({},n,{sensorEndpoint:e});window.localStorage.setItem("kaste-user-token",JSON.stringify(r)),t(r)},C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=Object(r.useState)(null),n=Object(p.a)(t,2),a=n[0],l=n[1];return[a,function(t){l(t),setTimeout(function(){l(null)},1e3*e)}]},I=n(402),x=n(399),A=n(395),T=n(44),P=function(e){var t=e.children,n=e.setPage,a=e.logOut,c=e.page,o=e.actions,i=e.token,s=Object(r.useState)(!1),u=Object(p.a)(s,2),m=u[0],d=u[1],E=Object(r.useState)(!1),g=Object(p.a)(E,2),b=g[0],f=g[1],v=Object(r.useState)(!1),h=Object(p.a)(v,2),O=h[0],y=h[1],j=Object(r.useState)(!1),k=Object(p.a)(j,2),w=k[0],S=k[1],C=Object(r.useState)(!1),P=Object(p.a)(C,2),U=P[0],F=P[1],L=function(e){return function(){f(!1),n(e)}};Object(r.useEffect)(function(){o?(y(void 0!==o.camera),S(void 0!==o.reboot),F(void 0!==o.water)):(y(!1),S(!1),F(!1))},[o]);return l.a.createElement(l.a.Fragment,null,l.a.createElement(I.a,{maxWidth:I.a.onlyMobile.maxWidth,as:x.a.Pushable,style:{height:"100vh"}},l.a.createElement(x.a,{as:A.a,animation:"push",inverted:!0,onHide:function(){return f(!1)},vertical:!0,visible:b,icon:"labeled",width:"thin"},i&&l.a.createElement(A.a.Header,{as:"small",style:{color:"white"}},l.a.createElement(T.a,{name:"user",color:"green"}),i.username),l.a.createElement(A.a.Item,{onClick:L("Sensors")},l.a.createElement(T.a,{name:"info"}),"Sensors"),l.a.createElement(A.a.Item,{onClick:L("Chat")},l.a.createElement(T.a,{name:"comments outline"}),"Chat"),l.a.createElement(A.a.Item,{onClick:L("Settings")},l.a.createElement(T.a,{name:"settings"}),"Settings"),l.a.createElement(A.a.Item,{onClick:L("About")},l.a.createElement(T.a,{name:"question"}),"About"),l.a.createElement(A.a.Item,{disabled:!O,onClick:L("Video")},l.a.createElement(T.a,{name:"eye"}),"Live Feed"),l.a.createElement(A.a.Item,{disabled:!U||m,onClick:function(){d(!0),console.log("Watering plants plants"),setTimeout(function(){d(!1),console.log("Watering completed")},5e3)}},l.a.createElement(T.a,{name:"exclamation"}),"Water plants"),l.a.createElement(A.a.Item,{disabled:!w,onClick:function(){return console.log("Reboot rasp")}},l.a.createElement(T.a,{name:"redo"}),"Reboot rasp")),l.a.createElement(x.a.Pusher,{style:{height:"100%"},dimmed:b},l.a.createElement(A.a,{widths:3,inverted:!0,pointing:!0,color:"green",size:"large",style:{height:"50px",marginBottom:0,borderRadius:0}},l.a.createElement(A.a.Item,{onClick:function(){return f(!0)},style:{alignSelf:"center"}},l.a.createElement(T.a,{name:"sidebar"})),l.a.createElement(A.a.Item,{header:!0},c),l.a.createElement(A.a.Item,{position:"right",onClick:function(){return a()},style:{alignSelf:"center"}},l.a.createElement(T.a,{name:"log out"}))),l.a.createElement("div",{style:{height:"calc(100vh - 50px)"}},t))))},U=function(e){var t=e.children,n=e.setPage,a=e.logOut,c=Object(r.useState)(!1),o=Object(p.a)(c,2),i=o[0],s=o[1],u=function(e){return function(){n(e)}};return l.a.createElement(l.a.Fragment,null,l.a.createElement(I.a,{style:{height:"100vh"},minWidth:I.a.onlyTablet.minWidth},l.a.createElement(A.a,{style:{height:71},inverted:!0,icon:"labeled",color:"green",fixed:"top"},l.a.createElement(A.a.Item,{onClick:u("Sensors")},l.a.createElement(T.a,{name:"info"}),"Sensors"),l.a.createElement(A.a.Item,{onClick:u("Chat")},l.a.createElement(T.a,{name:"comments outline"}),"Chat"),l.a.createElement(A.a.Item,{disabled:i,onClick:function(){s(!0),console.log("Watering plants plants"),setTimeout(function(){s(!1),console.log("Watering completed")},5e3)}},l.a.createElement(T.a,{name:"exclamation"}),"Water plants"),l.a.createElement(A.a.Item,{onClick:function(){return console.log("Reboot rasp")}},l.a.createElement(T.a,{name:"redo"}),"Reboot rasp"),l.a.createElement(A.a.Item,{onClick:u("Video")},l.a.createElement(T.a,{name:"eye"}),"Live Feed"),l.a.createElement(A.a.Menu,{position:"right"},l.a.createElement(A.a.Item,{onClick:u("Settings")},l.a.createElement(T.a,{name:"settings"}),"Settings"),l.a.createElement(A.a.Item,{onClick:u("About")},l.a.createElement(T.a,{name:"question"}),"About"),l.a.createElement(A.a.Item,{onClick:function(){return a(!1)}},l.a.createElement(T.a,{name:"log out"}),"Log out"))),l.a.createElement("div",{style:{height:71}}),l.a.createElement("div",{style:{height:"calc(100vh - 71px)"}},t)))},F=function(e){var t=e.children,n=e.setPage,a=e.logOut,r=e.page,c=e.actions,o=e.token;return l.a.createElement(l.a.Fragment,null,l.a.createElement(P,{logOut:a,page:r,actions:c,setPage:n,token:o},t),l.a.createElement(U,{logOut:a,setPage:n,actions:c},t))},L=n(401),R=n(396),W=n(389),q=n(398),z=n(376),$=n(394),D=n(383),J=n(33),N=n(34);function M(){var e=Object(J.a)(["\nmutation loginUser(\n  $password: String!\n  $username: String!\n  ) {\n  login(\n    password: $password\n    username: $username\n  ) {\n    value\n    username\n    sensorEndpoint\n  }\n}\n"]);return M=function(){return e},e}var V=Object(N.a)(M());function B(){var e=Object(J.a)(["\n{\n  me {\n    name\n    username\n    id\n    sensorEndpoint\n  }\n}\n"]);return B=function(){return e},e}var H=Object(N.a)(B()),Q=function(e){var t=e.setToken,n=Object(D.a)(V),a=C(),c=Object(p.a)(a,2),o=c[0],i=c[1],s=Object(r.useState)(""),u=Object(p.a)(s,2),m=u[0],d=u[1],E=Object(r.useState)(""),g=Object(p.a)(E,2),b=g[0],f=g[1],v=function(){var e=Object(O.a)(h.a.mark(function e(){return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n({update:function(e,n){var a=n.data.login;t(a),localStorage.setItem("kaste-user-token",JSON.stringify(a))},variables:{username:m,password:b},refetchQueries:[{query:H}]});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),i(e.t0.graphQLErrors[0].message);case 8:case"end":return e.stop()}},e,null,[[0,5]])}));return function(){return e.apply(this,arguments)}}();return l.a.createElement("div",{className:"login-form"},l.a.createElement("style",null," ","\n  body > div,\n  body > div > div,\n  body > div > div > div.login-form {\n    height: 100%;\n  }\n          "),l.a.createElement(L.a,{textAlign:"center",style:{height:"100%",background:"lightgreen"},verticalAlign:"middle"},l.a.createElement(L.a.Column,{style:{maxWidth:250}},l.a.createElement(R.a,{as:"h1",color:"grey",dividing:!0,textAlign:"center"},"Log in to Kaste 2.0"),l.a.createElement(W.a,{size:"large",onSubmit:v},l.a.createElement(q.a,{stacked:!0,raised:!0},l.a.createElement(W.a.Input,{type:"text",value:m,onChange:function(e){var t=e.target;return d(t.value)},fluid:!0,icon:"user",iconPosition:"left",placeholder:"Username"}),l.a.createElement(W.a.Input,{type:"password",value:b,onChange:function(e){var t=e.target;return f(t.value)},fluid:!0,icon:"lock",iconPosition:"left",placeholder:"Password"}),l.a.createElement(z.a,{color:"brown",size:"large",type:"submit"},"Log in")),o&&l.a.createElement($.a,{negative:!0},o)))))},_=n(391),K=function(e){var t=e.value,n=(e.label,e.icon);return l.a.createElement(l.a.Fragment,null,l.a.createElement(_.a.Item,null,l.a.createElement(_.a.Content,{style:{color:"white"}},l.a.createElement(_.a.Icon,{name:n}),t)))},Y=function(){return l.a.createElement("p",null,"Hello World!")},G=function(e){var t=e.sensor,n=Object(r.useState)(!1),a=Object(p.a)(n,2),c=a[0],o=a[1];return l.a.createElement(q.a,{color:"green",inverted:!0,secondary:!0,style:{margin:"2px 1px"}},l.a.createElement(R.a,{textAlign:"left",as:"h3"},l.a.createElement(T.a,{name:"leaf",size:"large"}),"Capsicum baccatum"),l.a.createElement(_.a,{divided:!0,horizontal:!0},l.a.createElement(K,{value:t.soil_moisture+" %",label:"Soil moisture",icon:"theme"}),l.a.createElement(K,{value:t.light+" %",label:"Light",icon:"sun"}),l.a.createElement(K,{value:t.temperature_C+" \xbaC",label:"Temperature",icon:"thermometer"}),l.a.createElement(K,{value:t.nutrient+" %",label:"Nutrient",icon:"meh"}),l.a.createElement(K,{value:t.time,label:"Updated",icon:"time"}),l.a.createElement(K,{value:t.battery_low+" %",label:"Battery",icon:"battery full"})),l.a.createElement(z.a,{circular:!0,icon:"chart area",onClick:function(){return o(!c)}}),l.a.createElement(q.a,{style:{display:"".concat(c?"block":"none")}},l.a.createElement(Y,null)))},X=function(e){var t=e.sensor;return l.a.createElement(q.a,{color:"brown",inverted:!0,secondary:!0,style:{margin:"2px 1px"}},l.a.createElement(K,{value:t.type,label:"Type",icon:"home"}),l.a.createElement(K,{value:t.model,label:"Model",icon:""}),l.a.createElement(K,{value:t.location,label:"Location",icon:""}),l.a.createElement(K,{value:t.humidity,label:"Humidity",icon:""}),l.a.createElement(K,{value:t.temperature_C,label:"Temperature",icon:"thermometer"}),l.a.createElement(K,{value:t.time,label:"Updated"}))},Z=function(e){var t=e.show,n=e.sensorData;if(!t)return null;return l.a.createElement("div",{style:{height:"100%",overflowY:"scroll"}},n?n.map(function(e){return"plant"===e.type?l.a.createElement(G,{key:e.id,sensor:e}):l.a.createElement(X,{key:e.id,sensor:e})}):null)},ee=n(400),te=n(387),ne=n(388),ae=n(390),re=n(384);function le(){var e=Object(J.a)(["\n{\n  messages {\n    content\n    created\n    id\n    user {\n      name\n    }\n  }\n}\n"]);return le=function(){return e},e}var ce=Object(N.a)(le());function oe(){var e=Object(J.a)(["\nmutation createMessage(\n  $content: String!\n  ) {\n  createMessage(\n    content: $content\n  ) {\n    content\n    user {\n      name\n    }\n    created\n    id\n  }\n}\n"]);return oe=function(){return e},e}var ie=Object(N.a)(oe());function se(){var e=Object(J.a)(["\nsubscription {\n  messageAdded {\n    content\n    created\n    id\n    user {\n      name\n    }\n  }\n}\n"]);return se=function(){return e},e}var ue=Object(N.a)(se()),me=n(385),de=function(e){var t=e.message,n=e.currentUser;if(!n.me)return null;var a=n.me.name===t.user.name?"blue":"green",r=n.me.name===t.user.name?"left":"right",c={margin:"0 0 5px 0",padding:7,float:"".concat(r),clear:"both"};return l.a.createElement(ae.a,{style:{marginTop:7,paddingTop:7,overflow:"auto"}},l.a.createElement(q.a,{style:c,compact:!0,inverted:!0,color:a,secondary:!0},l.a.createElement(ae.a.Content,null,l.a.createElement(ae.a.Author,{as:"a"},t.user.name),l.a.createElement(ae.a.Metadata,null,l.a.createElement("div",null,new Date(parseInt(t.created)).toLocaleString())),l.a.createElement(me.a,{style:{margin:"4px 0px 4px 0px"}}),t.content)))},Ee=n(393),ge=n(386),be=function(){return l.a.createElement(Ee.a,{active:!0},l.a.createElement(ge.a,{size:"massive",inverted:!0},"Loading"))},fe=function(e){var t=e.show,n=Object(ee.a)(ce),a=n.data,c=n.loading,o=Object(ee.a)(H),i=Object(r.useState)(""),s=Object(p.a)(i,2),u=s[0],m=s[1],d=Object(r.useRef)(null);Object(r.useEffect)(function(){g()},[t]);var E=Object(D.a)(ie),g=(Object(te.a)(ue,{onSubscriptionData:function(e){var t=e.client,n=e.subscriptionData,a=t.readQuery({query:ce}),r=n.data.messageAdded;k(a.messages,r.id)||(a.messages.push(r),t.writeQuery({query:ce,data:a,id:1}),d.current.scrollIntoView({block:"end",behavior:"smooth"}))}}),function(){d.current&&d.current.scrollIntoView({block:"end",behavior:"smooth"})}),b=function(){u.length<1||(E({variables:{content:u}}),m(""))};return t?l.a.createElement("div",{style:{height:"100%"}},l.a.createElement(ne.a,{style:{height:"90%",overflowY:"scroll"}},c||o.loading?l.a.createElement(be,null):l.a.createElement(ae.a.Group,null,a.messages.map(function(e){return l.a.createElement(de,{key:e.id,message:e,currentUser:o.data})})),l.a.createElement("div",{id:"el",ref:d})),l.a.createElement(A.a,{fluid:!0,color:"grey",style:{marginBottom:0,marginTop:0,height:"10%"}},l.a.createElement(A.a.Item,{style:{width:"80vw"}},l.a.createElement(re.a,{fluid:!0,value:u,onChange:function(e){var t=e.target;return m(t.value)},onKeyPress:function(e){"Enter"===e.key&&b()},onFocus:g})),l.a.createElement(A.a.Item,{style:{width:"20vw",justifyContent:"center"},onClick:b},l.a.createElement(T.a,{name:"send",inverted:!0,circular:!0,color:"green"})))):null},pe=n(392),ve=function(e){return e.show?l.a.createElement(ne.a,{textAlign:"center"},l.a.createElement(R.a,{as:"h1",style:{padding:25}},"About Kaste 2.0"),l.a.createElement(pe.a,{style:{background:"lightgreen"}},l.a.createElement("tbody",null,l.a.createElement("tr",null,l.a.createElement("td",null,"Aim:"),l.a.createElement("td",null,"Design and implement a responsive web app to monitor and water plants.")),l.a.createElement("tr",null,l.a.createElement("td",null,"Features:"),l.a.createElement("td",null,l.a.createElement("ul",null,l.a.createElement("li",null,"Plantwatering functionality for two or more users"),l.a.createElement("li",null,"Possibility to read plant info through charts"),l.a.createElement("li",null,"Simple chat"),l.a.createElement("li",null,"Rebooting Raspberry (that controls sensor data)"))))))):null};function he(){var e=Object(J.a)(["\nmutation editUserSensorEndpoint(\n  $sensorEndpoint: String!\n  ) {\n    editUserSensorEndpoint(\n    sensorEndpoint: $sensorEndpoint\n  ) {\n    sensorEndpoint\n    name\n    username\n  }\n}\n"]);return he=function(){return e},e}var Oe=Object(N.a)(he()),ye=function(e){var t=e.sensorsConnected,n=e.token,a=e.setToken,c=Object(r.useState)(""),o=Object(p.a)(c,2),i=o[0],s=o[1],u=C(),m=Object(p.a)(u,2),d=m[0],E=m[1],g=Object(D.a)(Oe),b=function(){var e=Object(O.a)(h.a.mark(function e(){var t;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.a.get(i);case 3:t=e.sent,Object.keys(t.data).includes("sensors")&&window.confirm("Would you like to receive information about these sensors?")&&(g({variables:{sensorEndpoint:i}}),S(i,a),s("")),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),E(e.t0.message);case 11:case"end":return e.stop()}},e,null,[[0,8]])}));return function(){return e.apply(this,arguments)}}();return l.a.createElement(q.a,null,l.a.createElement(R.a,null,"Sensor resource URL"),l.a.createElement("small",{style:{color:"gray"}},"Provide an endpoint URL where sensor output comes from"),l.a.createElement(re.a,{value:i,onChange:function(e){var t=e.target;return s(t.value)},fluid:!0,placeholder:"Enter URL...",action:l.a.createElement(z.a,{loading:!1,onClick:b},"connect")}),t?l.a.createElement(q.a,{color:"green"},l.a.createElement(R.a,{as:"h3"},"connected at:"),n.sensorEndpoint,l.a.createElement(z.a,{fluid:!0,style:{marginTop:10},onClick:function(){window.confirm("Are you sure? Clearing sensor resource url cuts access to all information and functionality.")&&(g({variables:{sensorEndpoint:""}}),S("",a))}},"clear")):l.a.createElement(q.a,{color:"red"},"not connected"),l.a.createElement(me.a,null),d&&l.a.createElement($.a,{color:"red"},d))},je=function(e){var t=e.show,n=e.sensorsConnected,a=e.token,r=e.setToken;return t?l.a.createElement(L.a,{divided:"vertically"},l.a.createElement(L.a.Row,null,l.a.createElement(L.a.Column,null,l.a.createElement(ye,{sensorsConnected:n,token:a,setToken:r})))):null},ke=n(199),we=function(e){var t=e.setReloadImage;return l.a.createElement("div",{style:{textAlign:"center"}},l.a.createElement(T.a,{name:"frown",inverted:!0,color:"grey",size:"massive"}),l.a.createElement(q.a,{color:"red",inverted:!0,secondary:!0,compact:!0},l.a.createElement("p",{style:{color:"white"}},"Image failed to load...")),l.a.createElement(z.a,{circular:!0,icon:"redo",onClick:Object(O.a)(h.a.mark(function e(){return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t(!0);case 2:t(!1);case 3:case"end":return e.stop()}},e)}))}))},Se={height:"100%",background:"black",display:"flex",alignItems:"center",justifyContent:"center"},Ce=function(e){var t=e.show,n=e.actions,a=Object(r.useState)(l.a.createElement(be,null)),c=Object(p.a)(a,2),o=c[0],i=c[1],s=Object(r.useState)("block"),u=Object(p.a)(s,2),m=u[0],d=u[1],E=Object(r.useState)(!1),g=Object(p.a)(E,2),b=g[0],f=g[1];return Object(r.useEffect)(function(){i(l.a.createElement(be,null)),d("block")},[t,b]),!t||b?null:l.a.createElement("div",{style:Se},o,n?l.a.createElement(ke.a,{style:{maxWidth:800,display:"".concat(m)},centered:!0,src:n.camera,fluid:!0,onLoad:function(){return i(null)},onError:function(){i(l.a.createElement(we,{setReloadImage:f})),d("none")}}):null)},Ie=function(){var e=Object(r.useState)("Sensors"),t=Object(p.a)(e,2),n=t[0],a=t[1],c=Object(r.useState)(JSON.parse(localStorage.getItem("kaste-user-token"))),o=Object(p.a)(c,2),s=o[0],u=o[1],m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:60,t=Object(r.useState)(null),n=Object(p.a)(t,2),a=n[0],l=n[1],c=Object(r.useState)(null),o=Object(p.a)(c,2),i=o[0],s=o[1],u=Object(r.useState)(!1),m=Object(p.a)(u,2),d=m[0],E=m[1],g=C(null),b=Object(p.a)(g,2),f=b[0],v=b[1],y=Object(r.useState)(null),k=Object(p.a)(y,2),S=k[0],I=k[1],x=function(){var e=Object(O.a)(h.a.mark(function e(t){var n;return h.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,j.a.get(t);case 3:n=e.sent,l(w(n.data.sensors)),s(n.data.actions),E(!0),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),E(!1),v(e.t0);case 13:case"end":return e.stop()}},e,null,[[0,9]])}));return function(t){return e.apply(this,arguments)}}();return[a,i,{startFetching:function(t){console.log("fetching..."),x(t);var n=setInterval(function(){console.log("fetching..."),x(t)},1e3*e);I(n)},stopFetching:function(){console.log("IntervalId",S),clearInterval(S),l(null),E(!1),s(null)}},d,f]}(60),d=Object(p.a)(m,5),E=d[0],g=d[1],b=d[2],f=d[3],v=(d[4],Object(i.b)());Object(r.useEffect)(function(){s&&s.sensorEndpoint?b.startFetching(s.sensorEndpoint):b.stopFetching()},[s]);return l.a.createElement(l.a.Fragment,null,s?l.a.createElement(F,{page:n,setPage:a,logOut:function(){a("Settings"),b.stopFetching(),u(null),localStorage.clear(),v.resetStore()},actions:g,token:s},l.a.createElement(Z,{sensorData:E,show:"Sensors"===n}),l.a.createElement(fe,{show:"Chat"===n}),l.a.createElement(ve,{show:"About"===n}),l.a.createElement(je,{show:"Settings"===n,sensorsConnected:f,token:s,setToken:u}),l.a.createElement(Ce,{show:"Video"===n,token:s,actions:g})):l.a.createElement(Q,{setToken:u}))},xe=new g.a({uri:f.wsUrl,options:{reconnect:!0}}),Ae=Object(u.b)({uri:f.httpUrl}),Te=Object(d.a)(function(e,t){var n=t.headers,r=JSON.parse(localStorage.getItem("kaste-user-token"));return{headers:Object(a.a)({},n,{authorization:r?"bearer ".concat(r.value):null})}}),Pe=Object(E.d)(function(e){var t=e.query,n=Object(b.l)(t),a=n.kind,r=n.operation;return"OperationDefinition"===a&&"subscription"===r},xe,Te.concat(Ae)),Ue=new s.a({link:Pe,cache:new m.a});o.a.render(l.a.createElement(i.a,{client:Ue},l.a.createElement(Ie,null)),document.getElementById("root"))}},[[210,1,2]]]);
//# sourceMappingURL=main.7642e371.chunk.js.map